<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE NoImplicitPrelude #-}</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE TypeOperators #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><span id="line-8"></span><span>
</span><span id="line-9"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-10"></span><span class="hs-comment">-- Module      : OAlg.AbelianGroup.Free.SmithNormalForm</span><span>
</span><span id="line-11"></span><span class="hs-comment">-- Description : diagonal and Smith Normal Form for matrices over integers</span><span>
</span><span id="line-12"></span><span class="hs-comment">-- Copyright   : (c) Erich Gut</span><span>
</span><span id="line-13"></span><span class="hs-comment">-- License     : BSD3</span><span>
</span><span id="line-14"></span><span class="hs-comment">-- Maintainer  : zerich.gut@gmail.com</span><span>
</span><span id="line-15"></span><span class="hs-comment">--</span><span>
</span><span id="line-16"></span><span class="hs-comment">-- diagonal and Smith Normal Form for 'Z'-matrices.</span><span>
</span><span id="line-17"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">OAlg.AbelianGroup.Free.SmithNormalForm</span><span>
</span><span id="line-18"></span><span>  </span><span class="hs-special">(</span><span>
</span><span id="line-19"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Diagonal Form</span></span><span>
</span><span id="line-20"></span><span>    </span><span class="annot"><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#zmxDiagonalForm"><span class="hs-identifier">zmxDiagonalForm</span></a></span><span>
</span><span id="line-21"></span><span>
</span><span id="line-22"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Smith Normal Form</span></span><span>
</span><span id="line-23"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#smithNormalForm"><span class="hs-identifier">smithNormalForm</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#smithNormalForm%27"><span class="hs-identifier">smithNormalForm'</span></a></span><span>
</span><span id="line-24"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#zmxDiagonalFormStrictPositive"><span class="hs-identifier">zmxDiagonalFormStrictPositive</span></a></span><span>
</span><span id="line-25"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#SmithNormalForm"><span class="hs-identifier">SmithNormalForm</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#snfDiagonalForm"><span class="hs-identifier">snfDiagonalForm</span></a></span><span>
</span><span id="line-26"></span><span>
</span><span id="line-27"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Proposition</span></span><span>
</span><span id="line-28"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#prpDiagonalFormZ"><span class="hs-identifier">prpDiagonalFormZ</span></a></span><span>
</span><span id="line-29"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-31"></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(++)</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">repeat</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">dropWhile</span></span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">OAlg.Prelude</span></span><span>
</span><span id="line-36"></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">OAlg.Data.Canonical</span></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">OAlg.Data.Constructable</span></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">OAlg.Data.Reducible</span></span><span>
</span><span id="line-40"></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">OAlg.Structure.Oriented</span></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">OAlg.Structure.Additive</span></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">OAlg.Structure.Multiplicative</span></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">OAlg.Structure.Number</span></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">OAlg.Structure.Ring</span></span><span>
</span><span id="line-46"></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">OAlg.Entity.Product</span></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">OAlg.Entity.Matrix</span></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">OAlg.Entity.Sequence.Permutation</span></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">OAlg.Entity.Sequence.PSequence</span></span><span>
</span><span id="line-51"></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="OAlg.AbelianGroup.Euclid.html"><span class="hs-identifier">OAlg.AbelianGroup.Euclid</span></a></span><span>
</span><span id="line-53"></span><span>
</span><span id="line-54"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-55"></span><span class="hs-comment">-- crDiagonalForm -</span><span>
</span><span id="line-56"></span><span>
</span><span id="line-57"></span><span class="hs-keyword">type</span><span> </span><span id="TPRows"><span class="annot"><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#TPRows"><span class="hs-identifier hs-var">TPRows</span></a></span></span><span> </span><span id="local-6989586621679083445"><span class="annot"><a href="#local-6989586621679083445"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ProductForm</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Z</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Transformation</span></span><span> </span><span class="annot"><a href="#local-6989586621679083445"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span class="hs-keyword">type</span><span> </span><span id="TPCols"><span class="annot"><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#TPCols"><span class="hs-identifier hs-var">TPCols</span></a></span></span><span> </span><span id="local-6989586621679083447"><span class="annot"><a href="#local-6989586621679083447"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ProductForm</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Z</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Transformation</span></span><span> </span><span class="annot"><a href="#local-6989586621679083447"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span class="hs-keyword">type</span><span> </span><span id="NF"><span class="annot"><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#NF"><span class="hs-identifier hs-var">NF</span></a></span></span><span> </span><span id="local-6989586621679083448"><span class="annot"><a href="#local-6989586621679083448"><span class="hs-identifier hs-type">a</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679083448"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#TPRows"><span class="hs-identifier hs-type">TPRows</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083448"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#TPCols"><span class="hs-identifier hs-type">TPCols</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083448"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span>
</span><span id="line-61"></span><span class="hs-comment">-- | reducing a matrix over 'Z' to a diagonal matrix by applying elements of @'GLT' 'Z'@.</span><span>
</span><span id="line-62"></span><span class="hs-comment">-- The entries of the diagonal may not be successively divisible!</span><span>
</span><span id="line-63"></span><span id="local-6989586621679083130"><span id="local-6989586621679083131"><span class="annot"><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#crDiagonalForm"><span class="hs-identifier hs-type">crDiagonalForm</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679083130"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">N</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679083131"><span class="hs-identifier hs-type">j</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">N</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Dim</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Z</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Dim</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Z</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Col</span></span><span> </span><span class="annot"><a href="#local-6989586621679083130"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Row</span></span><span> </span><span class="annot"><a href="#local-6989586621679083131"><span class="hs-identifier hs-type">j</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Z</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#NF"><span class="hs-identifier hs-type">NF</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Z</span></span></span></span><span>
</span><span id="line-64"></span><span id="crDiagonalForm"><span class="annot"><span class="annottext">crDiagonalForm :: forall i j.
(i ~ N, j ~ N) =&gt;
Dim Z () -&gt; Dim Z () -&gt; Col i (Row j Z) -&gt; NF Z
</span><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#crDiagonalForm"><span class="hs-identifier hs-var hs-var">crDiagonalForm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">i -&gt; Dim' Z -&gt; Dim' Z -&gt; Col i (Row j Z) -&gt; NF Z
forall i j.
(i ~ N, j ~ N) =&gt;
i -&gt; Dim' Z -&gt; Dim' Z -&gt; Col i (Row j Z) -&gt; NF Z
</span><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#dnf%27"><span class="hs-identifier hs-var">dnf'</span></a></span><span> </span><span class="annot"><span class="annottext">i
</span><span class="hs-number">0</span></span><span>
</span><span id="line-65"></span><span>
</span><span id="line-66"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-67"></span><span class="hs-comment">-- dnf -</span><span>
</span><span id="line-68"></span><span>
</span><span id="line-69"></span><span id="local-6989586621679083141"><span id="local-6989586621679083142"><span class="annot"><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#dnfis"><span class="hs-identifier hs-type">dnfis</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679083141"><span class="hs-identifier hs-type">j</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679083141"><span class="hs-identifier hs-type">j</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Col</span></span><span> </span><span class="annot"><a href="#local-6989586621679083142"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Row</span></span><span> </span><span class="annot"><a href="#local-6989586621679083141"><span class="hs-identifier hs-type">j</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Z</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Z</span></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621679083142"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span></span></span><span>
</span><span id="line-70"></span><span id="dnfis"><span class="annot"><span class="annottext">dnfis :: forall j i. Eq j =&gt; j -&gt; Col i (Row j Z) -&gt; [(Z, i)]
</span><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#dnfis"><span class="hs-identifier hs-var hs-var">dnfis</span></a></span></span><span> </span><span id="local-6989586621679083464"><span class="annot"><span class="annottext">j
</span><a href="#local-6989586621679083464"><span class="hs-identifier hs-var">j</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Col i Z -&gt; [(Z, i)]
forall i x. Col i x -&gt; [(x, i)]
</span><span class="hs-identifier hs-var">colxs</span></span><span> </span><span class="annot"><span class="annottext">(Col i Z -&gt; [(Z, i)])
-&gt; (Col i (Row j Z) -&gt; Col i Z) -&gt; Col i (Row j Z) -&gt; [(Z, i)]
forall y z x. (y -&gt; z) -&gt; (x -&gt; y) -&gt; x -&gt; z
forall (c :: * -&gt; * -&gt; *) y z x.
Category c =&gt;
c y z -&gt; c x y -&gt; c x z
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Col i Z -&gt; Col i Z
forall i x. Col i x -&gt; Col i x
</span><span class="hs-identifier hs-var">colTail</span></span><span> </span><span class="annot"><span class="annottext">(Col i Z -&gt; Col i Z)
-&gt; (Col i (Row j Z) -&gt; Col i Z) -&gt; Col i (Row j Z) -&gt; Col i Z
forall y z x. (y -&gt; z) -&gt; (x -&gt; y) -&gt; x -&gt; z
forall (c :: * -&gt; * -&gt; *) y z x.
Category c =&gt;
c y z -&gt; c x y -&gt; c x z
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">j -&gt; Col i (Row j Z) -&gt; Col i Z
forall j i a. Eq j =&gt; j -&gt; Col i (Row j a) -&gt; Col i a
</span><span class="hs-identifier hs-var">crHeadColAt</span></span><span> </span><span class="annot"><span class="annottext">j
</span><a href="#local-6989586621679083464"><span class="hs-identifier hs-var">j</span></a></span><span>
</span><span id="line-71"></span><span>
</span><span id="line-72"></span><span id="local-6989586621679083156"><span id="local-6989586621679083157"><span class="annot"><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#dnfjs"><span class="hs-identifier hs-type">dnfjs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679083156"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679083156"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Col</span></span><span> </span><span class="annot"><a href="#local-6989586621679083156"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Row</span></span><span> </span><span class="annot"><a href="#local-6989586621679083157"><span class="hs-identifier hs-type">j</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Z</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Z</span></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621679083157"><span class="hs-identifier hs-type">j</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span></span></span><span>
</span><span id="line-73"></span><span id="dnfjs"><span class="annot"><span class="annottext">dnfjs :: forall i j. Eq i =&gt; i -&gt; Col i (Row j Z) -&gt; [(Z, j)]
</span><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#dnfjs"><span class="hs-identifier hs-var hs-var">dnfjs</span></a></span></span><span> </span><span id="local-6989586621679083474"><span class="annot"><span class="annottext">i
</span><a href="#local-6989586621679083474"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Row j Z -&gt; [(Z, j)]
forall j x. Row j x -&gt; [(x, j)]
</span><span class="hs-identifier hs-var">rowxs</span></span><span> </span><span class="annot"><span class="annottext">(Row j Z -&gt; [(Z, j)])
-&gt; (Col i (Row j Z) -&gt; Row j Z) -&gt; Col i (Row j Z) -&gt; [(Z, j)]
forall y z x. (y -&gt; z) -&gt; (x -&gt; y) -&gt; x -&gt; z
forall (c :: * -&gt; * -&gt; *) y z x.
Category c =&gt;
c y z -&gt; c x y -&gt; c x z
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Row j Z -&gt; Row j Z
forall j x. Row j x -&gt; Row j x
</span><span class="hs-identifier hs-var">rowTail</span></span><span> </span><span class="annot"><span class="annottext">(Row j Z -&gt; Row j Z)
-&gt; (Col i (Row j Z) -&gt; Row j Z) -&gt; Col i (Row j Z) -&gt; Row j Z
forall y z x. (y -&gt; z) -&gt; (x -&gt; y) -&gt; x -&gt; z
forall (c :: * -&gt; * -&gt; *) y z x.
Category c =&gt;
c y z -&gt; c x y -&gt; c x z
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">i -&gt; Col i (Row j Z) -&gt; Row j Z
forall i j a. Eq i =&gt; i -&gt; Col i (Row j a) -&gt; Row j a
</span><span class="hs-identifier hs-var">crHeadRowAt</span></span><span> </span><span class="annot"><span class="annottext">i
</span><a href="#local-6989586621679083474"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-74"></span><span>
</span><span id="line-75"></span><span>
</span><span id="line-76"></span><span class="hs-comment">-- | transformation by the given offset to diagonal form where the entries of the</span><span>
</span><span id="line-77"></span><span class="hs-comment">-- diagonal may not be successively divisible.</span><span>
</span><span id="line-78"></span><span class="hs-comment">--</span><span>
</span><span id="line-79"></span><span class="hs-comment">-- __Properties__ Let @r@ be in 'N', @n@, @m@ in @'Dim'' 'Z'@ and @rws@ be in</span><span>
</span><span id="line-80"></span><span class="hs-comment">-- @'Col' i ('Row' j 'Z')@ where for all entries @(x,(i,j)@ in @rws@ holds</span><span>
</span><span id="line-81"></span><span class="hs-comment">--</span><span>
</span><span id="line-82"></span><span class="hs-comment">-- (1) @x '/= 0@.</span><span>
</span><span id="line-83"></span><span class="hs-comment">--</span><span>
</span><span id="line-84"></span><span class="hs-comment">-- (2) @r '&lt;=' i@ and @r '&lt;=' j@.</span><span>
</span><span id="line-85"></span><span class="hs-comment">--</span><span>
</span><span id="line-86"></span><span class="hs-comment">-- then holds: Let @(ds,a',b') = 'dnf'' r n m rws@ in</span><span>
</span><span id="line-87"></span><span class="hs-comment">--</span><span>
</span><span id="line-88"></span><span class="hs-comment">-- (1) @0 &lt; d@ for all @d@ in @ds@.</span><span>
</span><span id="line-89"></span><span class="hs-comment">--</span><span>
</span><span id="line-90"></span><span class="hs-comment">-- (2) @(a 'OAlg.Structure.Operational.*&gt;' 'Matrix' n m ('crets' rws))</span><span>
</span><span id="line-91"></span><span class="hs-comment">-- 'OAlg.Structure.Operational.&lt;*' b '==' 'diagonal'' r n m ds@ where</span><span>
</span><span id="line-92"></span><span class="hs-comment">-- @a' = 'RowTrafo' ('make' a' :: 'GLT' 'Z')@ and @b = 'ColTrafo' ('make' b :: 'GLT' 'Z')@.</span><span>
</span><span id="line-93"></span><span id="local-6989586621679083139"><span id="local-6989586621679083140"><span class="annot"><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#dnf%27"><span class="hs-identifier hs-type">dnf'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679083139"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">N</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679083140"><span class="hs-identifier hs-type">j</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">N</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679083139"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Dim'</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Z</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Dim'</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Z</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Col</span></span><span> </span><span class="annot"><a href="#local-6989586621679083139"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Row</span></span><span> </span><span class="annot"><a href="#local-6989586621679083140"><span class="hs-identifier hs-type">j</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Z</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#NF"><span class="hs-identifier hs-type">NF</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Z</span></span></span></span><span>
</span><span id="line-94"></span><span id="dnf%27"><span class="annot"><span class="annottext">dnf' :: forall i j.
(i ~ N, j ~ N) =&gt;
i -&gt; Dim' Z -&gt; Dim' Z -&gt; Col i (Row j Z) -&gt; NF Z
</span><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#dnf%27"><span class="hs-identifier hs-var hs-var">dnf'</span></a></span></span><span> </span><span id="local-6989586621679083494"><span class="annot"><span class="annottext">i
</span><a href="#local-6989586621679083494"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621679083495"><span class="annot"><span class="annottext">Dim' Z
</span><a href="#local-6989586621679083495"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679083496"><span class="annot"><span class="annottext">Dim' Z
</span><a href="#local-6989586621679083496"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621679083497"><span class="annot"><span class="annottext">Col i (Row j Z)
</span><a href="#local-6989586621679083497"><span class="hs-identifier hs-var">rws</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Dim Z () -&gt; Dim Z () -&gt; N -&gt; Col i (Row j Z) -&gt; NF Z -&gt; NF Z
forall i j.
(i ~ N, j ~ N) =&gt;
Dim Z () -&gt; Dim Z () -&gt; N -&gt; Col i (Row j Z) -&gt; NF Z -&gt; NF Z
</span><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#dnf1"><span class="hs-identifier hs-var">dnf1</span></a></span><span> </span><span class="annot"><span class="annottext">Dim Z ()
Dim' Z
</span><a href="#local-6989586621679083495"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Dim Z ()
Dim' Z
</span><a href="#local-6989586621679083496"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">i
N
</span><a href="#local-6989586621679083494"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Col i (Row j Z)
</span><a href="#local-6989586621679083497"><span class="hs-identifier hs-var">rws</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">Point (Transformation Z) -&gt; ProductForm Z (Transformation Z)
forall r a. Point a -&gt; ProductForm r a
</span><span class="hs-identifier hs-var">One</span></span><span> </span><span class="annot"><span class="annottext">Point (Transformation Z)
Dim' Z
</span><a href="#local-6989586621679083495"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Point (Transformation Z) -&gt; ProductForm Z (Transformation Z)
forall r a. Point a -&gt; ProductForm r a
</span><span class="hs-identifier hs-var">One</span></span><span> </span><span class="annot"><span class="annottext">Point (Transformation Z)
Dim' Z
</span><a href="#local-6989586621679083496"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-95"></span><span>
</span><span id="line-96"></span><span class="hs-comment">-- | pre:</span><span>
</span><span id="line-97"></span><span class="hs-comment">--</span><span>
</span><span id="line-98"></span><span class="hs-comment">--   (1) for all @i@, @j@ in @rws@ holds: @r '&lt;=' i@ and @r '&lt;=' j@. </span><span>
</span><span id="line-99"></span><span id="local-6989586621679083169"><span id="local-6989586621679083170"><span class="annot"><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#dnf1"><span class="hs-identifier hs-type">dnf1</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679083169"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">N</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679083170"><span class="hs-identifier hs-type">j</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">N</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Dim</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Z</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Dim</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Z</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">N</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Col</span></span><span> </span><span class="annot"><a href="#local-6989586621679083169"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Row</span></span><span> </span><span class="annot"><a href="#local-6989586621679083170"><span class="hs-identifier hs-type">j</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Z</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#NF"><span class="hs-identifier hs-type">NF</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Z</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#NF"><span class="hs-identifier hs-type">NF</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Z</span></span></span></span><span>
</span><span id="line-100"></span><span id="dnf1"><span class="annot"><span class="annottext">dnf1 :: forall i j.
(i ~ N, j ~ N) =&gt;
Dim Z () -&gt; Dim Z () -&gt; N -&gt; Col i (Row j Z) -&gt; NF Z -&gt; NF Z
</span><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#dnf1"><span class="hs-identifier hs-var hs-var">dnf1</span></a></span></span><span> </span><span id="local-6989586621679083511"><span class="annot"><span class="annottext">Dim Z ()
</span><a href="#local-6989586621679083511"><span class="hs-identifier hs-var">dr</span></a></span></span><span> </span><span id="local-6989586621679083512"><span class="annot"><span class="annottext">Dim Z ()
</span><a href="#local-6989586621679083512"><span class="hs-identifier hs-var">dc</span></a></span></span><span> </span><span id="local-6989586621679083513"><span class="annot"><span class="annottext">N
</span><a href="#local-6989586621679083513"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621679083514"><span class="annot"><span class="annottext">Col i (Row j Z)
</span><a href="#local-6989586621679083514"><span class="hs-identifier hs-var">rws</span></a></span></span><span> </span><span id="local-6989586621679083515"><span class="annot"><span class="annottext">NF Z
</span><a href="#local-6989586621679083515"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Col i (Row j Z) -&gt; Bool
forall i x. Col i x -&gt; Bool
</span><span class="hs-identifier hs-var">colIsEmpty</span></span><span> </span><span class="annot"><span class="annottext">Col i (Row j Z)
</span><a href="#local-6989586621679083514"><span class="hs-identifier hs-var">rws</span></a></span><span>
</span><span id="line-101"></span><span>  </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">NF Z
</span><a href="#local-6989586621679083515"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-102"></span><span>  </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Dim Z ()
-&gt; Dim Z ()
-&gt; N
-&gt; Col i (Row j Z)
-&gt; [(Z, i)]
-&gt; [(Z, i)]
-&gt; NF Z
-&gt; NF Z
forall i j.
(i ~ N, j ~ N) =&gt;
Dim Z ()
-&gt; Dim Z ()
-&gt; N
-&gt; Col i (Row j Z)
-&gt; [(Z, i)]
-&gt; [(Z, i)]
-&gt; NF Z
-&gt; NF Z
</span><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#dnf3"><span class="hs-identifier hs-var">dnf3</span></a></span><span> </span><span class="annot"><span class="annottext">Dim Z ()
</span><a href="#local-6989586621679083511"><span class="hs-identifier hs-var">dr</span></a></span><span> </span><span class="annot"><span class="annottext">Dim Z ()
</span><a href="#local-6989586621679083512"><span class="hs-identifier hs-var">dc</span></a></span><span> </span><span class="annot"><span class="annottext">N
</span><a href="#local-6989586621679083513"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Col i (Row j Z)
</span><a href="#local-6989586621679083518"><span class="hs-identifier hs-var">rws'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">N -&gt; Col i (Row N Z) -&gt; [(Z, i)]
forall j i. Eq j =&gt; j -&gt; Col i (Row j Z) -&gt; [(Z, i)]
</span><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#dnfis"><span class="hs-identifier hs-var">dnfis</span></a></span><span> </span><span class="annot"><span class="annottext">N
</span><a href="#local-6989586621679083513"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Col i (Row j Z)
Col i (Row N Z)
</span><a href="#local-6989586621679083518"><span class="hs-identifier hs-var">rws'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">N -&gt; Col N (Row i Z) -&gt; [(Z, i)]
forall i j. Eq i =&gt; i -&gt; Col i (Row j Z) -&gt; [(Z, j)]
</span><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#dnfjs"><span class="hs-identifier hs-var">dnfjs</span></a></span><span> </span><span class="annot"><span class="annottext">N
</span><a href="#local-6989586621679083513"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Col i (Row j Z)
Col N (Row i Z)
</span><a href="#local-6989586621679083518"><span class="hs-identifier hs-var">rws'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NF Z
</span><a href="#local-6989586621679083519"><span class="hs-identifier hs-var">res'</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-103"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679083518"><span class="annot"><span class="annottext">Col i (Row j Z)
</span><a href="#local-6989586621679083518"><span class="hs-identifier hs-var">rws'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679083519"><span class="annot"><span class="annottext">NF Z
</span><a href="#local-6989586621679083519"><span class="hs-identifier hs-var">res'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Dim Z ()
-&gt; Dim Z ()
-&gt; N
-&gt; Col i (Row j Z)
-&gt; NF Z
-&gt; (Col i (Row j Z), NF Z)
forall i j.
(i ~ N, j ~ N) =&gt;
Dim Z ()
-&gt; Dim Z ()
-&gt; N
-&gt; Col i (Row j Z)
-&gt; NF Z
-&gt; (Col i (Row j Z), NF Z)
</span><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#dnf2"><span class="hs-identifier hs-var">dnf2</span></a></span><span> </span><span class="annot"><span class="annottext">Dim Z ()
</span><a href="#local-6989586621679083511"><span class="hs-identifier hs-var">dr</span></a></span><span> </span><span class="annot"><span class="annottext">Dim Z ()
</span><a href="#local-6989586621679083512"><span class="hs-identifier hs-var">dc</span></a></span><span> </span><span class="annot"><span class="annottext">N
</span><a href="#local-6989586621679083513"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Col i (Row j Z)
</span><a href="#local-6989586621679083514"><span class="hs-identifier hs-var">rws</span></a></span><span> </span><span class="annot"><span class="annottext">NF Z
</span><a href="#local-6989586621679083515"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-104"></span><span>
</span><span id="line-105"></span><span class="hs-comment">-- | swap a non zero entry to the position @(r,r)@ and scale it to be strict positive.</span><span>
</span><span id="line-106"></span><span class="hs-comment">--</span><span>
</span><span id="line-107"></span><span class="hs-comment">-- pre:</span><span>
</span><span id="line-108"></span><span class="hs-comment">--</span><span>
</span><span id="line-109"></span><span class="hs-comment">-- (1) @rws@ is not empty.</span><span>
</span><span id="line-110"></span><span class="hs-comment">--</span><span>
</span><span id="line-111"></span><span class="hs-comment">-- (2) for all @i@, @j@ in @rws@ holds: @r '&lt;=' i@ and @r '&lt;=' j@.</span><span>
</span><span id="line-112"></span><span class="hs-comment">--</span><span>
</span><span id="line-113"></span><span class="hs-comment">-- post:</span><span>
</span><span id="line-114"></span><span class="hs-comment">--</span><span>
</span><span id="line-115"></span><span class="hs-comment">-- (1) the entry @0 '&lt;' rws' r r@.</span><span>
</span><span id="line-116"></span><span id="local-6989586621679083183"><span id="local-6989586621679083184"><span class="annot"><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#dnf2"><span class="hs-identifier hs-type">dnf2</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679083183"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">N</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679083184"><span class="hs-identifier hs-type">j</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">N</span></span><span class="hs-special">)</span><span>
</span><span id="line-117"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Dim</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Z</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Dim</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Z</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">N</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Col</span></span><span> </span><span class="annot"><a href="#local-6989586621679083183"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Row</span></span><span> </span><span class="annot"><a href="#local-6989586621679083184"><span class="hs-identifier hs-type">j</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Z</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#NF"><span class="hs-identifier hs-type">NF</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Z</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Col</span></span><span> </span><span class="annot"><a href="#local-6989586621679083183"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Row</span></span><span> </span><span class="annot"><a href="#local-6989586621679083184"><span class="hs-identifier hs-type">j</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Z</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#NF"><span class="hs-identifier hs-type">NF</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Z</span></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-118"></span><span id="dnf2"><span class="annot"><span class="annottext">dnf2 :: forall i j.
(i ~ N, j ~ N) =&gt;
Dim Z ()
-&gt; Dim Z ()
-&gt; N
-&gt; Col i (Row j Z)
-&gt; NF Z
-&gt; (Col i (Row j Z), NF Z)
</span><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#dnf2"><span class="hs-identifier hs-var hs-var">dnf2</span></a></span></span><span> </span><span id="local-6989586621679083541"><span class="annot"><span class="annottext">Dim Z ()
</span><a href="#local-6989586621679083541"><span class="hs-identifier hs-var">dr</span></a></span></span><span> </span><span id="local-6989586621679083542"><span class="annot"><span class="annottext">Dim Z ()
</span><a href="#local-6989586621679083542"><span class="hs-identifier hs-var">dc</span></a></span></span><span> </span><span id="local-6989586621679083543"><span class="annot"><span class="annottext">N
</span><a href="#local-6989586621679083543"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621679083544"><span class="annot"><span class="annottext">Col i (Row j Z)
</span><a href="#local-6989586621679083544"><span class="hs-identifier hs-var">rws</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679083545"><span class="annot"><span class="annottext">[Z]
</span><a href="#local-6989586621679083545"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679083546"><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679083546"><span class="hs-identifier hs-var">trs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679083547"><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679083547"><span class="hs-identifier hs-var">tcs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Col i (Row j Z)
Col N (Row N Z)
</span><a href="#local-6989586621679083548"><span class="hs-identifier hs-var">rws'</span></a></span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Z]
</span><a href="#local-6989586621679083545"><span class="hs-identifier hs-var">ds</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679083549"><span class="hs-identifier hs-var">trs'</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679083550"><span class="hs-identifier hs-var">tcs'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-119"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679083551"><span class="annot"><span class="annottext">Row j Z
</span><a href="#local-6989586621679083551"><span class="hs-identifier hs-var">rw</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679083552"><span class="annot"><span class="annottext">i
</span><a href="#local-6989586621679083552"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Col i (Row j Z) -&gt; (Row j Z, i)
forall i x. Col i x -&gt; (x, i)
</span><span class="hs-identifier hs-var">colHead</span></span><span> </span><span class="annot"><span class="annottext">Col i (Row j Z)
</span><a href="#local-6989586621679083544"><span class="hs-identifier hs-var">rws</span></a></span><span>
</span><span id="line-120"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679083554"><span class="annot"><span class="annottext">Z
</span><a href="#local-6989586621679083554"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679083555"><span class="annot"><span class="annottext">j
</span><a href="#local-6989586621679083555"><span class="hs-identifier hs-var">j</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Row j Z -&gt; (Z, j)
forall j x. Row j x -&gt; (x, j)
</span><span class="hs-identifier hs-var">rowHead</span></span><span> </span><span class="annot"><span class="annottext">Row j Z
</span><a href="#local-6989586621679083551"><span class="hs-identifier hs-var">rw</span></a></span><span>
</span><span id="line-121"></span><span>  </span><span id="local-6989586621679083557"><span class="annot"><span class="annottext">sa :: Z
</span><a href="#local-6989586621679083557"><span class="hs-identifier hs-var hs-var">sa</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Z -&gt; Z
forall r. Number r =&gt; r -&gt; r
</span><span class="hs-identifier hs-var">signum</span></span><span> </span><span class="annot"><span class="annottext">Z
</span><a href="#local-6989586621679083554"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-122"></span><span>
</span><span id="line-123"></span><span>  </span><span id="local-6989586621679083548"><span class="annot"><span class="annottext">rws' :: Col N (Row N Z)
</span><a href="#local-6989586621679083548"><span class="hs-identifier hs-var hs-var">rws'</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GLT Z
</span><a href="#local-6989586621679083559"><span class="hs-identifier hs-var">tr</span></a></span><span> </span><span class="annot"><span class="annottext">GLT Z -&gt; Col N (Row N Z) -&gt; Col N (Row N Z)
forall {a} {x}.
Embeddable a (ProductForm N (Transformation x)) =&gt;
a -&gt; Col N (Row N x) -&gt; Col N (Row N x)
</span><a href="#local-6989586621679083560"><span class="hs-operator hs-var">|&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Col i (Row j Z)
Col N (Row N Z)
</span><a href="#local-6989586621679083544"><span class="hs-identifier hs-var">rws</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Col N (Row N Z) -&gt; GLT Z -&gt; Col N (Row N Z)
forall {a} {x}.
Embeddable a (ProductForm N (Transformation x)) =&gt;
Col N (Row N x) -&gt; a -&gt; Col N (Row N x)
</span><a href="#local-6989586621679083561"><span class="hs-operator hs-var">&lt;|</span></a></span><span> </span><span class="annot"><span class="annottext">GLT Z
</span><a href="#local-6989586621679083562"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-124"></span><span>    </span><span id="local-6989586621679083565"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679083565"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621679083560"><span class="annot"><span class="annottext">|&gt; :: a -&gt; Col N (Row N x) -&gt; Col N (Row N x)
</span><a href="#local-6989586621679083560"><span class="hs-operator hs-var hs-var">|&gt;</span></a></span></span><span> </span><span id="local-6989586621679083566"><span class="annot"><span class="annottext">Col N (Row N x)
</span><a href="#local-6989586621679083566"><span class="hs-identifier hs-var">rws</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Transformation x -&gt; Col N (Row N x) -&gt; Col N (Row N x))
-&gt; ProductForm N (Transformation x)
-&gt; Col N (Row N x)
-&gt; Col N (Row N x)
forall t x. (t -&gt; x -&gt; x) -&gt; ProductForm N t -&gt; x -&gt; x
</span><span class="hs-identifier hs-var">prfopl</span></span><span> </span><span class="annot"><span class="annottext">Transformation x -&gt; Col N (Row N x) -&gt; Col N (Row N x)
forall x. Transformation x -&gt; Col N (Row N x) -&gt; Col N (Row N x)
</span><span class="hs-identifier hs-var">crTrafoRows</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; ProductForm N (Transformation x)
forall a b. Embeddable a b =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">inj</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679083565"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Col N (Row N x)
</span><a href="#local-6989586621679083566"><span class="hs-identifier hs-var">rws</span></a></span><span>
</span><span id="line-125"></span><span>    </span><span id="local-6989586621679083572"><span class="annot"><span class="annottext">Col N (Row N x)
</span><a href="#local-6989586621679083572"><span class="hs-identifier hs-var">rws</span></a></span></span><span> </span><span id="local-6989586621679083561"><span class="annot"><span class="annottext">&lt;| :: Col N (Row N x) -&gt; a -&gt; Col N (Row N x)
</span><a href="#local-6989586621679083561"><span class="hs-operator hs-var hs-var">&lt;|</span></a></span></span><span> </span><span id="local-6989586621679083573"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679083573"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Col N (Row N x) -&gt; Transformation x -&gt; Col N (Row N x))
-&gt; Col N (Row N x)
-&gt; ProductForm N (Transformation x)
-&gt; Col N (Row N x)
forall x t. (x -&gt; t -&gt; x) -&gt; x -&gt; ProductForm N t -&gt; x
</span><span class="hs-identifier hs-var">prfopr</span></span><span> </span><span class="annot"><span class="annottext">Col N (Row N x) -&gt; Transformation x -&gt; Col N (Row N x)
forall x. Col N (Row N x) -&gt; Transformation x -&gt; Col N (Row N x)
</span><span class="hs-identifier hs-var">crTrafoCols</span></span><span> </span><span class="annot"><span class="annottext">Col N (Row N x)
</span><a href="#local-6989586621679083572"><span class="hs-identifier hs-var">rws</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; ProductForm N (Transformation x)
forall a b. Embeddable a b =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">inj</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679083573"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-126"></span><span>    </span><span class="hs-comment">-- tr and tc are reduced and hence alle exponentes are bigger then zero!</span><span>
</span><span id="line-127"></span><span>    </span><span>
</span><span id="line-128"></span><span>  </span><span id="local-6989586621679083559"><span class="annot"><span class="annottext">tr :: GLT Z
</span><a href="#local-6989586621679083559"><span class="hs-identifier hs-var hs-var">tr</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Form (GLT Z) -&gt; GLT Z
forall x. Constructable x =&gt; Form x -&gt; x
</span><span class="hs-identifier hs-var">make</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Transformation Z -&gt; ProductForm Z (Transformation Z)
forall r a. a -&gt; ProductForm r a
</span><span class="hs-identifier hs-var">P</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dim' Z -&gt; N -&gt; Inv Z -&gt; Transformation Z
forall x.
Distributive x =&gt;
Dim x (Point x) -&gt; N -&gt; Inv x -&gt; Transformation x
</span><span class="hs-identifier hs-var">Scale</span></span><span> </span><span class="annot"><span class="annottext">Dim Z ()
Dim' Z
</span><a href="#local-6989586621679083541"><span class="hs-identifier hs-var">dr</span></a></span><span> </span><span class="annot"><span class="annottext">N
</span><a href="#local-6989586621679083543"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Z -&gt; Z -&gt; Inv Z
forall c. c -&gt; c -&gt; Inv c
</span><span class="hs-identifier hs-var">Inv</span></span><span> </span><span class="annot"><span class="annottext">Z
</span><a href="#local-6989586621679083557"><span class="hs-identifier hs-var">sa</span></a></span><span> </span><span class="annot"><span class="annottext">Z
</span><a href="#local-6989586621679083557"><span class="hs-identifier hs-var">sa</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
-&gt; ProductForm Z (Transformation Z)
-&gt; ProductForm Z (Transformation Z)
forall r a. ProductForm r a -&gt; ProductForm r a -&gt; ProductForm r a
</span><span class="hs-operator hs-var">:*</span></span><span> </span><span class="annot"><span class="annottext">Transformation Z -&gt; ProductForm Z (Transformation Z)
forall r a. a -&gt; ProductForm r a
</span><span class="hs-identifier hs-var">P</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dim' Z -&gt; Dim' Z -&gt; Permutation N -&gt; Transformation Z
forall x.
Distributive x =&gt;
Dim x (Point x)
-&gt; Dim x (Point x) -&gt; Permutation N -&gt; Transformation x
</span><span class="hs-identifier hs-var">Permute</span></span><span> </span><span class="annot"><span class="annottext">Dim Z ()
Dim' Z
</span><a href="#local-6989586621679083541"><span class="hs-identifier hs-var">dr</span></a></span><span> </span><span class="annot"><span class="annottext">Dim Z ()
Dim' Z
</span><a href="#local-6989586621679083541"><span class="hs-identifier hs-var">dr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">N -&gt; N -&gt; Permutation N
forall i. (Entity i, Ord i) =&gt; i -&gt; i -&gt; Permutation i
</span><span class="hs-identifier hs-var">swap</span></span><span> </span><span class="annot"><span class="annottext">N
</span><a href="#local-6989586621679083543"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">i
N
</span><a href="#local-6989586621679083552"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">GLT</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Z</span></span><span>
</span><span id="line-129"></span><span>  </span><span id="local-6989586621679083562"><span class="annot"><span class="annottext">tc :: GLT Z
</span><a href="#local-6989586621679083562"><span class="hs-identifier hs-var hs-var">tc</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Form (GLT Z) -&gt; GLT Z
forall x. Constructable x =&gt; Form x -&gt; x
</span><span class="hs-identifier hs-var">make</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Transformation Z -&gt; ProductForm Z (Transformation Z)
forall r a. a -&gt; ProductForm r a
</span><span class="hs-identifier hs-var">P</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dim' Z -&gt; Dim' Z -&gt; Permutation N -&gt; Transformation Z
forall x.
Distributive x =&gt;
Dim x (Point x)
-&gt; Dim x (Point x) -&gt; Permutation N -&gt; Transformation x
</span><span class="hs-identifier hs-var">Permute</span></span><span> </span><span class="annot"><span class="annottext">Dim Z ()
Dim' Z
</span><a href="#local-6989586621679083542"><span class="hs-identifier hs-var">dc</span></a></span><span> </span><span class="annot"><span class="annottext">Dim Z ()
Dim' Z
</span><a href="#local-6989586621679083542"><span class="hs-identifier hs-var">dc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">N -&gt; N -&gt; Permutation N
forall i. (Entity i, Ord i) =&gt; i -&gt; i -&gt; Permutation i
</span><span class="hs-identifier hs-var">swap</span></span><span> </span><span class="annot"><span class="annottext">N
</span><a href="#local-6989586621679083543"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">j
N
</span><a href="#local-6989586621679083555"><span class="hs-identifier hs-var">j</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">GLT</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Z</span></span><span>
</span><span id="line-130"></span><span>  </span><span id="local-6989586621679083549"><span class="annot"><span class="annottext">trs' :: ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679083549"><span class="hs-identifier hs-var hs-var">trs'</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GLT Z -&gt; Form (GLT Z)
forall x. Exposable x =&gt; x -&gt; Form x
</span><span class="hs-identifier hs-var">form</span></span><span> </span><span class="annot"><span class="annottext">GLT Z
</span><a href="#local-6989586621679083559"><span class="hs-identifier hs-var">tr</span></a></span><span> </span><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
-&gt; ProductForm Z (Transformation Z)
-&gt; ProductForm Z (Transformation Z)
forall r a. ProductForm r a -&gt; ProductForm r a -&gt; ProductForm r a
</span><span class="hs-operator hs-var">:*</span></span><span> </span><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679083546"><span class="hs-identifier hs-var">trs</span></a></span><span>
</span><span id="line-131"></span><span>  </span><span id="local-6989586621679083550"><span class="annot"><span class="annottext">tcs' :: ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679083550"><span class="hs-identifier hs-var hs-var">tcs'</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679083547"><span class="hs-identifier hs-var">tcs</span></a></span><span> </span><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
-&gt; ProductForm Z (Transformation Z)
-&gt; ProductForm Z (Transformation Z)
forall r a. ProductForm r a -&gt; ProductForm r a -&gt; ProductForm r a
</span><span class="hs-operator hs-var">:*</span></span><span> </span><span class="annot"><span class="annottext">GLT Z -&gt; Form (GLT Z)
forall x. Exposable x =&gt; x -&gt; Form x
</span><span class="hs-identifier hs-var">form</span></span><span> </span><span class="annot"><span class="annottext">GLT Z
</span><a href="#local-6989586621679083562"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-132"></span><span>
</span><span id="line-133"></span><span>
</span><span id="line-134"></span><span class="hs-comment">-- | @gcd@ of @a@ and @b@ with the appropriate row transformations to eliminate @b@.</span><span>
</span><span id="line-135"></span><span class="hs-comment">--</span><span>
</span><span id="line-136"></span><span class="hs-comment">-- pre: @0 &lt; a@, @k &lt; l@.</span><span>
</span><span id="line-137"></span><span id="local-6989586621679083213"><span class="annot"><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#tRows"><span class="hs-identifier hs-type">tRows</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679083213"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">N</span></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Dim</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Z</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Z</span></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621679083213"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Z</span></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621679083213"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Z</span></span><span class="hs-special">,</span><span class="annot"><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#TPRows"><span class="hs-identifier hs-type">TPRows</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Z</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-138"></span><span id="tRows"><span class="annot"><span class="annottext">tRows :: forall i.
(i ~ N) =&gt;
Dim Z ()
-&gt; (Z, i) -&gt; (Z, i) -&gt; (Z, ProductForm Z (Transformation Z))
</span><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#tRows"><span class="hs-identifier hs-var hs-var">tRows</span></a></span></span><span> </span><span id="local-6989586621679083603"><span class="annot"><span class="annottext">Dim Z ()
</span><a href="#local-6989586621679083603"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679083604"><span class="annot"><span class="annottext">Z
</span><a href="#local-6989586621679083604"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679083605"><span class="annot"><span class="annottext">i
</span><a href="#local-6989586621679083605"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679083606"><span class="annot"><span class="annottext">Z
</span><a href="#local-6989586621679083606"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679083607"><span class="annot"><span class="annottext">i
</span><a href="#local-6989586621679083607"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Z
-&gt; Z
-&gt; ProductForm Z (Transformation Z)
-&gt; (Z, ProductForm Z (Transformation Z))
</span><a href="#local-6989586621679083608"><span class="hs-identifier hs-var">trws</span></a></span><span> </span><span class="annot"><span class="annottext">Z
</span><a href="#local-6989586621679083604"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Z
</span><a href="#local-6989586621679083606"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point (Transformation Z) -&gt; ProductForm Z (Transformation Z)
forall r a. Point a -&gt; ProductForm r a
</span><span class="hs-identifier hs-var">One</span></span><span> </span><span class="annot"><span class="annottext">Point (Transformation Z)
Dim Z ()
</span><a href="#local-6989586621679083603"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-139"></span><span>  </span><span id="local-6989586621679083608"><span class="annot"><span class="annottext">trws :: Z
-&gt; Z
-&gt; ProductForm Z (Transformation Z)
-&gt; (Z, ProductForm Z (Transformation Z))
</span><a href="#local-6989586621679083608"><span class="hs-identifier hs-var hs-var">trws</span></a></span></span><span> </span><span id="local-6989586621679083609"><span class="annot"><span class="annottext">Z
</span><a href="#local-6989586621679083609"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679083610"><span class="annot"><span class="annottext">Z
</span><a href="#local-6989586621679083610"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621679083611"><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679083611"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Z
</span><a href="#local-6989586621679083612"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Z -&gt; Z -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Z
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Z
</span><a href="#local-6989586621679083609"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Transformation Z -&gt; ProductForm Z (Transformation Z)
forall r a. a -&gt; ProductForm r a
</span><span class="hs-identifier hs-var">P</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dim' Z -&gt; N -&gt; N -&gt; GL2 Z -&gt; Transformation Z
forall x.
Galoisian x =&gt;
Dim x (Point x) -&gt; N -&gt; N -&gt; GL2 x -&gt; Transformation x
</span><span class="hs-identifier hs-var">Shear</span></span><span> </span><span class="annot"><span class="annottext">Dim Z ()
Dim' Z
</span><a href="#local-6989586621679083603"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">i
N
</span><a href="#local-6989586621679083605"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">i
N
</span><a href="#local-6989586621679083607"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Z -&gt; Z -&gt; Z -&gt; Z -&gt; GL2 Z
forall x. x -&gt; x -&gt; x -&gt; x -&gt; GL2 x
</span><span class="hs-identifier hs-var">GL2</span></span><span> </span><span class="annot"><span class="annottext">Z
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Z
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Z
</span><a href="#local-6989586621679083615"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Z
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
-&gt; ProductForm Z (Transformation Z)
-&gt; ProductForm Z (Transformation Z)
forall r a. ProductForm r a -&gt; ProductForm r a -&gt; ProductForm r a
</span><span class="hs-operator hs-var">:*</span></span><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679083611"><span class="hs-identifier hs-var">ts</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-140"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679083615"><span class="annot"><span class="annottext">Z
</span><a href="#local-6989586621679083615"><span class="hs-identifier hs-var">q</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679083612"><span class="annot"><span class="annottext">Z
</span><a href="#local-6989586621679083612"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Z
</span><a href="#local-6989586621679083610"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Z -&gt; Z -&gt; (Z, Z)
forall a. Integral a =&gt; a -&gt; a -&gt; (a, a)
</span><span class="hs-operator hs-var">`divMod`</span></span><span> </span><span class="annot"><span class="annottext">Z
</span><a href="#local-6989586621679083609"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-141"></span><span>
</span><span id="line-142"></span><span>  </span><span class="annot"><a href="#local-6989586621679083608"><span class="hs-identifier hs-var">trws</span></a></span><span> </span><span id="local-6989586621679083617"><span class="annot"><span class="annottext">Z
</span><a href="#local-6989586621679083617"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679083618"><span class="annot"><span class="annottext">Z
</span><a href="#local-6989586621679083618"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621679083619"><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679083619"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Z
-&gt; Z
-&gt; ProductForm Z (Transformation Z)
-&gt; (Z, ProductForm Z (Transformation Z))
</span><a href="#local-6989586621679083608"><span class="hs-identifier hs-var">trws</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">N -&gt; Z
forall a b. Embeddable a b =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">inj</span></span><span> </span><span class="annot"><span class="annottext">N
</span><a href="#local-6989586621679083620"><span class="hs-identifier hs-var">g</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Z
</span><a href="#local-6989586621679083621"><span class="hs-identifier hs-var">v</span></a></span><span class="annot"><span class="annottext">Z -&gt; Z -&gt; Z
forall c. Multiplicative c =&gt; c -&gt; c -&gt; c
</span><span class="hs-operator hs-var">*</span></span><span class="annot"><span class="annottext">Z
</span><a href="#local-6989586621679083618"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Z -&gt; Z -&gt; Z
forall a. Abelian a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Z
</span><a href="#local-6989586621679083624"><span class="hs-identifier hs-var">u</span></a></span><span class="annot"><span class="annottext">Z -&gt; Z -&gt; Z
forall c. Multiplicative c =&gt; c -&gt; c -&gt; c
</span><span class="hs-operator hs-var">*</span></span><span class="annot"><span class="annottext">Z
</span><a href="#local-6989586621679083617"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679083625"><span class="hs-identifier hs-var">tr</span></a></span><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
-&gt; ProductForm Z (Transformation Z)
-&gt; ProductForm Z (Transformation Z)
forall r a. ProductForm r a -&gt; ProductForm r a -&gt; ProductForm r a
</span><span class="hs-operator hs-var">:*</span></span><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679083619"><span class="hs-identifier hs-var">ts</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-143"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679083620"><span class="annot"><span class="annottext">N
</span><a href="#local-6989586621679083620"><span class="hs-identifier hs-var">g</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679083626"><span class="annot"><span class="annottext">Z
</span><a href="#local-6989586621679083626"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679083627"><span class="annot"><span class="annottext">Z
</span><a href="#local-6989586621679083627"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Z -&gt; Z -&gt; (N, Z, Z)
</span><a href="OAlg.AbelianGroup.Euclid.html#euclid"><span class="hs-identifier hs-var">euclid</span></a></span><span> </span><span class="annot"><span class="annottext">Z
</span><a href="#local-6989586621679083617"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Z
</span><a href="#local-6989586621679083618"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-144"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">N
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621679083624"><span class="annot"><span class="annottext">Z
</span><a href="#local-6989586621679083624"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679083621"><span class="annot"><span class="annottext">Z
</span><a href="#local-6989586621679083621"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Z -&gt; Z -&gt; (N, Z, Z)
</span><a href="OAlg.AbelianGroup.Euclid.html#euclid"><span class="hs-identifier hs-var">euclid</span></a></span><span> </span><span class="annot"><span class="annottext">Z
</span><a href="#local-6989586621679083627"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Z
</span><a href="#local-6989586621679083626"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-comment">-- because g is gcd it follows that gcd s t == 1</span><span>
</span><span id="line-145"></span><span>    </span><span id="local-6989586621679083625"><span class="annot"><span class="annottext">tr :: ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679083625"><span class="hs-identifier hs-var hs-var">tr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Transformation Z -&gt; ProductForm Z (Transformation Z)
forall r a. a -&gt; ProductForm r a
</span><span class="hs-identifier hs-var">P</span></span><span> </span><span class="annot"><span class="annottext">(Transformation Z -&gt; ProductForm Z (Transformation Z))
-&gt; Transformation Z -&gt; ProductForm Z (Transformation Z)
forall (h :: * -&gt; * -&gt; *) a b. Applicative h =&gt; h a b -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Dim' Z -&gt; N -&gt; N -&gt; GL2 Z -&gt; Transformation Z
forall x.
Galoisian x =&gt;
Dim x (Point x) -&gt; N -&gt; N -&gt; GL2 x -&gt; Transformation x
</span><span class="hs-identifier hs-var">Shear</span></span><span> </span><span class="annot"><span class="annottext">Dim Z ()
Dim' Z
</span><a href="#local-6989586621679083603"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">i
N
</span><a href="#local-6989586621679083605"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">i
N
</span><a href="#local-6989586621679083607"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Z -&gt; Z -&gt; Z -&gt; Z -&gt; GL2 Z
forall x. x -&gt; x -&gt; x -&gt; x -&gt; GL2 x
</span><span class="hs-identifier hs-var">GL2</span></span><span> </span><span class="annot"><span class="annottext">Z
</span><a href="#local-6989586621679083626"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Z
</span><a href="#local-6989586621679083627"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Z
</span><a href="#local-6989586621679083624"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Z
</span><a href="#local-6989586621679083621"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-146"></span><span>
</span><span id="line-147"></span><span>
</span><span id="line-148"></span><span class="hs-comment">-- | @gcd@ of @a@ and @b@ with the appropriate column transformation to eliminate @b@.</span><span>
</span><span id="line-149"></span><span class="hs-comment">--</span><span>
</span><span id="line-150"></span><span class="hs-comment">-- pre: @0 &lt; a@, @k &lt; l@.</span><span>
</span><span id="line-151"></span><span id="local-6989586621679083630"><span class="annot"><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#tCols"><span class="hs-identifier hs-type">tCols</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679083630"><span class="hs-identifier hs-type">j</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">N</span></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Dim</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Z</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Z</span></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621679083630"><span class="hs-identifier hs-type">j</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Z</span></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621679083630"><span class="hs-identifier hs-type">j</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Z</span></span><span class="hs-special">,</span><span class="annot"><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#TPCols"><span class="hs-identifier hs-type">TPCols</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Z</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-152"></span><span id="tCols"><span class="annot"><span class="annottext">tCols :: forall i.
(i ~ N) =&gt;
Dim Z ()
-&gt; (Z, i) -&gt; (Z, i) -&gt; (Z, ProductForm Z (Transformation Z))
</span><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#tCols"><span class="hs-identifier hs-var hs-var">tCols</span></a></span></span><span> </span><span id="local-6989586621679083638"><span class="annot"><span class="annottext">Dim Z ()
</span><a href="#local-6989586621679083638"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621679083639"><span class="annot"><span class="annottext">(Z, j)
</span><a href="#local-6989586621679083639"><span class="hs-identifier hs-var">ak</span></a></span></span><span> </span><span id="local-6989586621679083640"><span class="annot"><span class="annottext">(Z, j)
</span><a href="#local-6989586621679083640"><span class="hs-identifier hs-var">bl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Z
</span><a href="#local-6989586621679083641"><span class="hs-identifier hs-var">g</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
-&gt; ProductForm Z (Transformation Z)
forall r. TransposableDistributive r =&gt; GLTForm r -&gt; GLTForm r
</span><span class="hs-identifier hs-var">gltfTrsp</span></span><span> </span><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679083643"><span class="hs-identifier hs-var">tr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-153"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679083641"><span class="annot"><span class="annottext">Z
</span><a href="#local-6989586621679083641"><span class="hs-identifier hs-var">g</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679083643"><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679083643"><span class="hs-identifier hs-var">tr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Dim Z ()
-&gt; (Z, j) -&gt; (Z, j) -&gt; (Z, ProductForm Z (Transformation Z))
forall i.
(i ~ N) =&gt;
Dim Z ()
-&gt; (Z, i) -&gt; (Z, i) -&gt; (Z, ProductForm Z (Transformation Z))
</span><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#tRows"><span class="hs-identifier hs-var">tRows</span></a></span><span> </span><span class="annot"><span class="annottext">Dim Z ()
</span><a href="#local-6989586621679083638"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">(Z, j)
</span><a href="#local-6989586621679083639"><span class="hs-identifier hs-var">ak</span></a></span><span> </span><span class="annot"><span class="annottext">(Z, j)
</span><a href="#local-6989586621679083640"><span class="hs-identifier hs-var">bl</span></a></span><span>
</span><span id="line-154"></span><span>
</span><span id="line-155"></span><span>
</span><span id="line-156"></span><span class="hs-comment">-- | eliminates all non zero entries in the @r@-th row and column</span><span>
</span><span id="line-157"></span><span class="hs-comment">--</span><span>
</span><span id="line-158"></span><span class="hs-comment">-- pre:</span><span>
</span><span id="line-159"></span><span class="hs-comment">--</span><span>
</span><span id="line-160"></span><span class="hs-comment">-- (1) the entry at @(r,r)@ is strict positive</span><span>
</span><span id="line-161"></span><span class="hs-comment">--</span><span>
</span><span id="line-162"></span><span class="hs-comment">-- (1) @is@ are the row numbers of @rws@ with non zero entries at the column @r@</span><span>
</span><span id="line-163"></span><span class="hs-comment">-- with @r '&lt;' i@ for all @i@ in @is@.</span><span>
</span><span id="line-164"></span><span class="hs-comment">--</span><span>
</span><span id="line-165"></span><span class="hs-comment">-- (1) @js@ are the column numbers of @rws@ with non zero entries at the row @r@</span><span>
</span><span id="line-166"></span><span class="hs-comment">-- with @r '&lt;' j@ for all @j@ in @js@.</span><span>
</span><span id="line-167"></span><span class="hs-comment">--</span><span>
</span><span id="line-168"></span><span class="hs-comment">-- post: all entries in the @r@-th row and column - except the one at position @(r,r)@ -</span><span>
</span><span id="line-169"></span><span class="hs-comment">-- are zero (i.e. are eliminated).</span><span>
</span><span id="line-170"></span><span id="local-6989586621679083181"><span id="local-6989586621679083182"><span class="annot"><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#dnf3"><span class="hs-identifier hs-type">dnf3</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679083181"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">N</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679083182"><span class="hs-identifier hs-type">j</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">N</span></span><span class="hs-special">)</span><span>
</span><span id="line-171"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Dim</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Z</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Dim</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Z</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">N</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Col</span></span><span> </span><span class="annot"><a href="#local-6989586621679083181"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Row</span></span><span> </span><span class="annot"><a href="#local-6989586621679083182"><span class="hs-identifier hs-type">j</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Z</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Z</span></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621679083181"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Z</span></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621679083181"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#NF"><span class="hs-identifier hs-type">NF</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Z</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#NF"><span class="hs-identifier hs-type">NF</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Z</span></span></span></span><span>
</span><span id="line-172"></span><span class="hs-comment">-- this algorithem terminates because in each step the number of primfactors of</span><span>
</span><span id="line-173"></span><span class="hs-comment">-- the entry at postion (r,r) is strict decreasing!</span><span>
</span><span id="line-174"></span><span id="dnf3"><span class="annot"><span class="annottext">dnf3 :: forall i j.
(i ~ N, j ~ N) =&gt;
Dim Z ()
-&gt; Dim Z ()
-&gt; N
-&gt; Col i (Row j Z)
-&gt; [(Z, i)]
-&gt; [(Z, i)]
-&gt; NF Z
-&gt; NF Z
</span><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#dnf3"><span class="hs-identifier hs-var hs-var">dnf3</span></a></span></span><span> </span><span id="local-6989586621679083679"><span class="annot"><span class="annottext">Dim Z ()
</span><a href="#local-6989586621679083679"><span class="hs-identifier hs-var">dr</span></a></span></span><span> </span><span id="local-6989586621679083680"><span class="annot"><span class="annottext">Dim Z ()
</span><a href="#local-6989586621679083680"><span class="hs-identifier hs-var">dc</span></a></span></span><span> </span><span id="local-6989586621679083681"><span class="annot"><span class="annottext">N
</span><a href="#local-6989586621679083681"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621679083682"><span class="annot"><span class="annottext">Col i (Row j Z)
</span><a href="#local-6989586621679083682"><span class="hs-identifier hs-var">rws</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621679083683"><span class="annot"><span class="annottext">NF Z
</span><a href="#local-6989586621679083683"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Z
</span><a href="#local-6989586621679083684"><span class="hs-identifier hs-var">d</span></a></span><span class="annot"><span class="annottext">Z -&gt; [Z] -&gt; [Z]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[Z]
</span><a href="#local-6989586621679083685"><span class="hs-identifier hs-var">ds</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679083686"><span class="hs-identifier hs-var">trs</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679083687"><span class="hs-identifier hs-var">tcs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-175"></span><span>  </span><span id="local-6989586621679083684"><span class="annot"><span class="annottext">d :: Z
</span><a href="#local-6989586621679083684"><span class="hs-identifier hs-var hs-var">d</span></a></span></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Z, N) -&gt; Z
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((Z, N) -&gt; Z) -&gt; (Z, N) -&gt; Z
forall (h :: * -&gt; * -&gt; *) a b. Applicative h =&gt; h a b -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Row N Z -&gt; (Z, N)
forall j x. Row j x -&gt; (x, j)
</span><span class="hs-identifier hs-var">rowHead</span></span><span> </span><span class="annot"><span class="annottext">(Row N Z -&gt; (Z, N)) -&gt; Row N Z -&gt; (Z, N)
forall (h :: * -&gt; * -&gt; *) a b. Applicative h =&gt; h a b -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Row j Z, i) -&gt; Row N Z
(Row N Z, N) -&gt; Row N Z
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((Row j Z, i) -&gt; Row N Z) -&gt; (Row j Z, i) -&gt; Row N Z
forall (h :: * -&gt; * -&gt; *) a b. Applicative h =&gt; h a b -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Col i (Row j Z) -&gt; (Row j Z, i)
forall i x. Col i x -&gt; (x, i)
</span><span class="hs-identifier hs-var">colHead</span></span><span> </span><span class="annot"><span class="annottext">Col i (Row j Z)
</span><a href="#local-6989586621679083682"><span class="hs-identifier hs-var">rws</span></a></span><span>
</span><span id="line-176"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679083685"><span class="annot"><span class="annottext">[Z]
</span><a href="#local-6989586621679083685"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679083686"><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679083686"><span class="hs-identifier hs-var">trs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679083687"><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679083687"><span class="hs-identifier hs-var">tcs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Dim Z () -&gt; Dim Z () -&gt; N -&gt; Col i (Row j Z) -&gt; NF Z -&gt; NF Z
forall i j.
(i ~ N, j ~ N) =&gt;
Dim Z () -&gt; Dim Z () -&gt; N -&gt; Col i (Row j Z) -&gt; NF Z -&gt; NF Z
</span><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#dnf1"><span class="hs-identifier hs-var">dnf1</span></a></span><span> </span><span class="annot"><span class="annottext">Dim Z ()
</span><a href="#local-6989586621679083679"><span class="hs-identifier hs-var">dr</span></a></span><span> </span><span class="annot"><span class="annottext">Dim Z ()
</span><a href="#local-6989586621679083680"><span class="hs-identifier hs-var">dc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">N
</span><a href="#local-6989586621679083681"><span class="hs-identifier hs-var">r</span></a></span><span class="annot"><span class="annottext">N -&gt; N -&gt; N
forall a. Additive a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">N
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Col i (Row j Z) -&gt; Col i (Row j Z)
forall i x. Col i x -&gt; Col i x
</span><span class="hs-identifier hs-var">colTail</span></span><span> </span><span class="annot"><span class="annottext">Col i (Row j Z)
</span><a href="#local-6989586621679083682"><span class="hs-identifier hs-var">rws</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NF Z
</span><a href="#local-6989586621679083683"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-177"></span><span>
</span><span id="line-178"></span><span class="hs-comment">-- eliminates the column</span><span>
</span><span id="line-179"></span><span class="annot"><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#dnf3"><span class="hs-identifier hs-var">dnf3</span></a></span><span> </span><span id="local-6989586621679083690"><span class="annot"><span class="annottext">Dim Z ()
</span><a href="#local-6989586621679083690"><span class="hs-identifier hs-var">dr</span></a></span></span><span> </span><span id="local-6989586621679083691"><span class="annot"><span class="annottext">Dim Z ()
</span><a href="#local-6989586621679083691"><span class="hs-identifier hs-var">dc</span></a></span></span><span> </span><span id="local-6989586621679083692"><span class="annot"><span class="annottext">N
</span><a href="#local-6989586621679083692"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621679083693"><span class="annot"><span class="annottext">Col i (Row j Z)
</span><a href="#local-6989586621679083693"><span class="hs-identifier hs-var">rws</span></a></span></span><span> </span><span id="local-6989586621679083694"><span class="annot"><span class="annottext">cl :: [(Z, i)]
</span><a href="#local-6989586621679083694"><span class="hs-identifier hs-var">cl</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Z, i)
</span><span class="hs-identifier">_</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[(Z, i)]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Z, i)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679083695"><span class="annot"><span class="annottext">[Z]
</span><a href="#local-6989586621679083695"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679083696"><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679083696"><span class="hs-identifier hs-var">trs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679083697"><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679083697"><span class="hs-identifier hs-var">tcs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-180"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Dim Z ()
-&gt; Dim Z ()
-&gt; N
-&gt; Col N (Row N Z)
-&gt; [(Z, N)]
-&gt; [(Z, N)]
-&gt; NF Z
-&gt; NF Z
forall i j.
(i ~ N, j ~ N) =&gt;
Dim Z ()
-&gt; Dim Z ()
-&gt; N
-&gt; Col i (Row j Z)
-&gt; [(Z, i)]
-&gt; [(Z, i)]
-&gt; NF Z
-&gt; NF Z
</span><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#dnf3"><span class="hs-identifier hs-var">dnf3</span></a></span><span> </span><span class="annot"><span class="annottext">Dim Z ()
</span><a href="#local-6989586621679083690"><span class="hs-identifier hs-var">dr</span></a></span><span> </span><span class="annot"><span class="annottext">Dim Z ()
</span><a href="#local-6989586621679083691"><span class="hs-identifier hs-var">dc</span></a></span><span> </span><span class="annot"><span class="annottext">N
</span><a href="#local-6989586621679083692"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Col N (Row N Z)
</span><a href="#local-6989586621679083698"><span class="hs-identifier hs-var">rws'</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">N -&gt; Col N (Row N Z) -&gt; [(Z, N)]
forall i j. Eq i =&gt; i -&gt; Col i (Row j Z) -&gt; [(Z, j)]
</span><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#dnfjs"><span class="hs-identifier hs-var">dnfjs</span></a></span><span> </span><span class="annot"><span class="annottext">N
</span><a href="#local-6989586621679083692"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Col N (Row N Z)
</span><a href="#local-6989586621679083698"><span class="hs-identifier hs-var">rws'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Z]
</span><a href="#local-6989586621679083695"><span class="hs-identifier hs-var">ds</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">GLT Z -&gt; Form (GLT Z)
forall x. Exposable x =&gt; x -&gt; Form x
</span><span class="hs-identifier hs-var">form</span></span><span> </span><span class="annot"><span class="annottext">GLT Z
</span><a href="#local-6989586621679083699"><span class="hs-identifier hs-var">tr</span></a></span><span> </span><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
-&gt; ProductForm Z (Transformation Z)
-&gt; ProductForm Z (Transformation Z)
forall r a. ProductForm r a -&gt; ProductForm r a -&gt; ProductForm r a
</span><span class="hs-operator hs-var">:*</span></span><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679083696"><span class="hs-identifier hs-var">trs</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679083697"><span class="hs-identifier hs-var">tcs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-181"></span><span>      </span><span id="local-6989586621679083702"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679083702"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621679083703"><span class="annot"><span class="annottext">*&gt; :: a -&gt; Col N (Row N x) -&gt; Col N (Row N x)
</span><a href="#local-6989586621679083703"><span class="hs-operator hs-var hs-var">*&gt;</span></a></span></span><span> </span><span id="local-6989586621679083704"><span class="annot"><span class="annottext">Col N (Row N x)
</span><a href="#local-6989586621679083704"><span class="hs-identifier hs-var">rws</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Transformation x -&gt; Col N (Row N x) -&gt; Col N (Row N x))
-&gt; ProductForm N (Transformation x)
-&gt; Col N (Row N x)
-&gt; Col N (Row N x)
forall t x. (t -&gt; x -&gt; x) -&gt; ProductForm N t -&gt; x -&gt; x
</span><span class="hs-identifier hs-var">prfopl</span></span><span> </span><span class="annot"><span class="annottext">Transformation x -&gt; Col N (Row N x) -&gt; Col N (Row N x)
forall x. Transformation x -&gt; Col N (Row N x) -&gt; Col N (Row N x)
</span><span class="hs-identifier hs-var">crTrafoRows</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; ProductForm N (Transformation x)
forall a b. Embeddable a b =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">inj</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679083702"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Col N (Row N x)
</span><a href="#local-6989586621679083704"><span class="hs-identifier hs-var">rws</span></a></span><span>
</span><span id="line-182"></span><span>      </span><span id="local-6989586621679083698"><span class="annot"><span class="annottext">rws' :: Col N (Row N Z)
</span><a href="#local-6989586621679083698"><span class="hs-identifier hs-var hs-var">rws'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GLT Z
</span><a href="#local-6989586621679083699"><span class="hs-identifier hs-var">tr</span></a></span><span> </span><span class="annot"><span class="annottext">GLT Z -&gt; Col N (Row N Z) -&gt; Col N (Row N Z)
forall {a} {x}.
Embeddable a (ProductForm N (Transformation x)) =&gt;
a -&gt; Col N (Row N x) -&gt; Col N (Row N x)
</span><a href="#local-6989586621679083703"><span class="hs-operator hs-var">*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Col i (Row j Z)
Col N (Row N Z)
</span><a href="#local-6989586621679083693"><span class="hs-identifier hs-var">rws</span></a></span><span>
</span><span id="line-183"></span><span>      </span><span id="local-6989586621679083705"><span class="annot"><span class="annottext">a :: Z
</span><a href="#local-6989586621679083705"><span class="hs-identifier hs-var hs-var">a</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Z, N) -&gt; Z
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((Z, N) -&gt; Z) -&gt; (Z, N) -&gt; Z
forall (h :: * -&gt; * -&gt; *) a b. Applicative h =&gt; h a b -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Row N Z -&gt; (Z, N)
forall j x. Row j x -&gt; (x, j)
</span><span class="hs-identifier hs-var">rowHead</span></span><span> </span><span class="annot"><span class="annottext">(Row N Z -&gt; (Z, N)) -&gt; Row N Z -&gt; (Z, N)
forall (h :: * -&gt; * -&gt; *) a b. Applicative h =&gt; h a b -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Row j Z, i) -&gt; Row N Z
(Row N Z, N) -&gt; Row N Z
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((Row j Z, i) -&gt; Row N Z) -&gt; (Row j Z, i) -&gt; Row N Z
forall (h :: * -&gt; * -&gt; *) a b. Applicative h =&gt; h a b -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Col i (Row j Z) -&gt; (Row j Z, i)
forall i x. Col i x -&gt; (x, i)
</span><span class="hs-identifier hs-var">colHead</span></span><span> </span><span class="annot"><span class="annottext">Col i (Row j Z)
</span><a href="#local-6989586621679083693"><span class="hs-identifier hs-var">rws</span></a></span><span>
</span><span id="line-184"></span><span>      </span><span id="local-6989586621679083699"><span class="annot"><span class="annottext">tr :: GLT Z
</span><a href="#local-6989586621679083699"><span class="hs-identifier hs-var hs-var">tr</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Form (GLT Z) -&gt; GLT Z
ProductForm Z (Transformation Z) -&gt; GLT Z
forall x. Constructable x =&gt; Form x -&gt; x
</span><span class="hs-identifier hs-var">make</span></span><span> </span><span class="annot"><span class="annottext">(ProductForm Z (Transformation Z) -&gt; GLT Z)
-&gt; ProductForm Z (Transformation Z) -&gt; GLT Z
forall (h :: * -&gt; * -&gt; *) a b. Applicative h =&gt; h a b -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">N
-&gt; Z
-&gt; [(Z, N)]
-&gt; ProductForm Z (Transformation Z)
-&gt; ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679083706"><span class="hs-identifier hs-var">elims</span></a></span><span> </span><span class="annot"><span class="annottext">N
</span><a href="#local-6989586621679083692"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Z
</span><a href="#local-6989586621679083705"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">[(Z, i)]
[(Z, N)]
</span><a href="#local-6989586621679083694"><span class="hs-identifier hs-var">cl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point (Transformation Z) -&gt; ProductForm Z (Transformation Z)
forall r a. Point a -&gt; ProductForm r a
</span><span class="hs-identifier hs-var">One</span></span><span> </span><span class="annot"><span class="annottext">Point (Transformation Z)
Dim Z ()
</span><a href="#local-6989586621679083690"><span class="hs-identifier hs-var">dr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">GLT</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Z</span></span><span>
</span><span id="line-185"></span><span>
</span><span id="line-186"></span><span>      </span><span id="local-6989586621679083706"><span class="annot"><span class="annottext">elims :: N
-&gt; Z
-&gt; [(Z, N)]
-&gt; ProductForm Z (Transformation Z)
-&gt; ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679083706"><span class="hs-identifier hs-var hs-var">elims</span></a></span></span><span> </span><span class="annot"><span class="annottext">N
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Z
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621679083707"><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679083707"><span class="hs-identifier hs-var">tr</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679083707"><span class="hs-identifier hs-var">tr</span></a></span><span>
</span><span id="line-187"></span><span>      </span><span class="annot"><a href="#local-6989586621679083706"><span class="hs-identifier hs-var">elims</span></a></span><span> </span><span id="local-6989586621679083708"><span class="annot"><span class="annottext">N
</span><a href="#local-6989586621679083708"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621679083709"><span class="annot"><span class="annottext">Z
</span><a href="#local-6989586621679083709"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621679083710"><span class="annot"><span class="annottext">Z
</span><a href="#local-6989586621679083710"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679083711"><span class="annot"><span class="annottext">N
</span><a href="#local-6989586621679083711"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679083712"><span class="annot"><span class="annottext">[(Z, N)]
</span><a href="#local-6989586621679083712"><span class="hs-identifier hs-var">bis</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679083713"><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679083713"><span class="hs-identifier hs-var">tr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">N
-&gt; Z
-&gt; [(Z, N)]
-&gt; ProductForm Z (Transformation Z)
-&gt; ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679083706"><span class="hs-identifier hs-var">elims</span></a></span><span> </span><span class="annot"><span class="annottext">N
</span><a href="#local-6989586621679083708"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Z
</span><a href="#local-6989586621679083714"><span class="hs-identifier hs-var">a'</span></a></span><span> </span><span class="annot"><span class="annottext">[(Z, N)]
</span><a href="#local-6989586621679083712"><span class="hs-identifier hs-var">bis</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679083715"><span class="hs-identifier hs-var">tr'</span></a></span><span> </span><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
-&gt; ProductForm Z (Transformation Z)
-&gt; ProductForm Z (Transformation Z)
forall r a. ProductForm r a -&gt; ProductForm r a -&gt; ProductForm r a
</span><span class="hs-operator hs-var">:*</span></span><span> </span><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679083713"><span class="hs-identifier hs-var">tr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-188"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679083714"><span class="annot"><span class="annottext">Z
</span><a href="#local-6989586621679083714"><span class="hs-identifier hs-var">a'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679083715"><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679083715"><span class="hs-identifier hs-var">tr'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Dim Z ()
-&gt; (Z, N) -&gt; (Z, N) -&gt; (Z, ProductForm Z (Transformation Z))
forall i.
(i ~ N) =&gt;
Dim Z ()
-&gt; (Z, i) -&gt; (Z, i) -&gt; (Z, ProductForm Z (Transformation Z))
</span><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#tRows"><span class="hs-identifier hs-var">tRows</span></a></span><span> </span><span class="annot"><span class="annottext">Dim Z ()
</span><a href="#local-6989586621679083690"><span class="hs-identifier hs-var">dr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Z
</span><a href="#local-6989586621679083709"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">N
</span><a href="#local-6989586621679083708"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Z
</span><a href="#local-6989586621679083710"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">N
</span><a href="#local-6989586621679083711"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span>
</span><span id="line-189"></span><span>
</span><span id="line-190"></span><span class="hs-comment">-- eliminates the row</span><span>
</span><span id="line-191"></span><span class="annot"><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#dnf3"><span class="hs-identifier hs-var">dnf3</span></a></span><span> </span><span id="local-6989586621679083716"><span class="annot"><span class="annottext">Dim Z ()
</span><a href="#local-6989586621679083716"><span class="hs-identifier hs-var">dr</span></a></span></span><span> </span><span id="local-6989586621679083717"><span class="annot"><span class="annottext">Dim Z ()
</span><a href="#local-6989586621679083717"><span class="hs-identifier hs-var">dc</span></a></span></span><span> </span><span id="local-6989586621679083718"><span class="annot"><span class="annottext">N
</span><a href="#local-6989586621679083718"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621679083719"><span class="annot"><span class="annottext">Col i (Row j Z)
</span><a href="#local-6989586621679083719"><span class="hs-identifier hs-var">rws</span></a></span></span><span> </span><span class="annot"><span class="annottext">[(Z, i)]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679083720"><span class="annot"><span class="annottext">rw :: [(Z, i)]
</span><a href="#local-6989586621679083720"><span class="hs-identifier hs-var">rw</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Z, i)
</span><span class="hs-identifier">_</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[(Z, i)]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679083721"><span class="annot"><span class="annottext">[Z]
</span><a href="#local-6989586621679083721"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679083722"><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679083722"><span class="hs-identifier hs-var">trs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679083723"><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679083723"><span class="hs-identifier hs-var">tcs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-192"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Dim Z ()
-&gt; Dim Z ()
-&gt; N
-&gt; Col N (Row N Z)
-&gt; [(Z, N)]
-&gt; [(Z, N)]
-&gt; NF Z
-&gt; NF Z
forall i j.
(i ~ N, j ~ N) =&gt;
Dim Z ()
-&gt; Dim Z ()
-&gt; N
-&gt; Col i (Row j Z)
-&gt; [(Z, i)]
-&gt; [(Z, i)]
-&gt; NF Z
-&gt; NF Z
</span><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#dnf3"><span class="hs-identifier hs-var">dnf3</span></a></span><span> </span><span class="annot"><span class="annottext">Dim Z ()
</span><a href="#local-6989586621679083716"><span class="hs-identifier hs-var">dr</span></a></span><span> </span><span class="annot"><span class="annottext">Dim Z ()
</span><a href="#local-6989586621679083717"><span class="hs-identifier hs-var">dc</span></a></span><span> </span><span class="annot"><span class="annottext">N
</span><a href="#local-6989586621679083718"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Col N (Row N Z)
</span><a href="#local-6989586621679083724"><span class="hs-identifier hs-var">rws'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">N -&gt; Col N (Row N Z) -&gt; [(Z, N)]
forall j i. Eq j =&gt; j -&gt; Col i (Row j Z) -&gt; [(Z, i)]
</span><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#dnfis"><span class="hs-identifier hs-var">dnfis</span></a></span><span> </span><span class="annot"><span class="annottext">N
</span><a href="#local-6989586621679083718"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Col N (Row N Z)
</span><a href="#local-6989586621679083724"><span class="hs-identifier hs-var">rws'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Z]
</span><a href="#local-6989586621679083721"><span class="hs-identifier hs-var">ds</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679083722"><span class="hs-identifier hs-var">trs</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679083723"><span class="hs-identifier hs-var">tcs</span></a></span><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
-&gt; ProductForm Z (Transformation Z)
-&gt; ProductForm Z (Transformation Z)
forall r a. ProductForm r a -&gt; ProductForm r a -&gt; ProductForm r a
</span><span class="hs-operator hs-var">:*</span></span><span> </span><span class="annot"><span class="annottext">GLT Z -&gt; Form (GLT Z)
forall x. Exposable x =&gt; x -&gt; Form x
</span><span class="hs-identifier hs-var">form</span></span><span> </span><span class="annot"><span class="annottext">GLT Z
</span><a href="#local-6989586621679083725"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-193"></span><span>      </span><span id="local-6989586621679083728"><span class="annot"><span class="annottext">Col N (Row N x)
</span><a href="#local-6989586621679083728"><span class="hs-identifier hs-var">rws</span></a></span></span><span> </span><span id="local-6989586621679083729"><span class="annot"><span class="annottext">&lt;* :: Col N (Row N x) -&gt; a -&gt; Col N (Row N x)
</span><a href="#local-6989586621679083729"><span class="hs-operator hs-var hs-var">&lt;*</span></a></span></span><span> </span><span id="local-6989586621679083730"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679083730"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Col N (Row N x) -&gt; Transformation x -&gt; Col N (Row N x))
-&gt; Col N (Row N x)
-&gt; ProductForm N (Transformation x)
-&gt; Col N (Row N x)
forall x t. (x -&gt; t -&gt; x) -&gt; x -&gt; ProductForm N t -&gt; x
</span><span class="hs-identifier hs-var">prfopr</span></span><span> </span><span class="annot"><span class="annottext">Col N (Row N x) -&gt; Transformation x -&gt; Col N (Row N x)
forall x. Col N (Row N x) -&gt; Transformation x -&gt; Col N (Row N x)
</span><span class="hs-identifier hs-var">crTrafoCols</span></span><span> </span><span class="annot"><span class="annottext">Col N (Row N x)
</span><a href="#local-6989586621679083728"><span class="hs-identifier hs-var">rws</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; ProductForm N (Transformation x)
forall a b. Embeddable a b =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">inj</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679083730"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-194"></span><span>      </span><span id="local-6989586621679083724"><span class="annot"><span class="annottext">rws' :: Col N (Row N Z)
</span><a href="#local-6989586621679083724"><span class="hs-identifier hs-var hs-var">rws'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Col i (Row j Z)
Col N (Row N Z)
</span><a href="#local-6989586621679083719"><span class="hs-identifier hs-var">rws</span></a></span><span> </span><span class="annot"><span class="annottext">Col N (Row N Z) -&gt; GLT Z -&gt; Col N (Row N Z)
forall {a} {x}.
Embeddable a (ProductForm N (Transformation x)) =&gt;
Col N (Row N x) -&gt; a -&gt; Col N (Row N x)
</span><a href="#local-6989586621679083729"><span class="hs-operator hs-var">&lt;*</span></a></span><span> </span><span class="annot"><span class="annottext">GLT Z
</span><a href="#local-6989586621679083725"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-195"></span><span>      </span><span id="local-6989586621679083731"><span class="annot"><span class="annottext">a :: Z
</span><a href="#local-6989586621679083731"><span class="hs-identifier hs-var hs-var">a</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Z, N) -&gt; Z
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((Z, N) -&gt; Z) -&gt; (Z, N) -&gt; Z
forall (h :: * -&gt; * -&gt; *) a b. Applicative h =&gt; h a b -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Row N Z -&gt; (Z, N)
forall j x. Row j x -&gt; (x, j)
</span><span class="hs-identifier hs-var">rowHead</span></span><span> </span><span class="annot"><span class="annottext">(Row N Z -&gt; (Z, N)) -&gt; Row N Z -&gt; (Z, N)
forall (h :: * -&gt; * -&gt; *) a b. Applicative h =&gt; h a b -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Row j Z, i) -&gt; Row N Z
(Row N Z, N) -&gt; Row N Z
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((Row j Z, i) -&gt; Row N Z) -&gt; (Row j Z, i) -&gt; Row N Z
forall (h :: * -&gt; * -&gt; *) a b. Applicative h =&gt; h a b -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Col i (Row j Z) -&gt; (Row j Z, i)
forall i x. Col i x -&gt; (x, i)
</span><span class="hs-identifier hs-var">colHead</span></span><span> </span><span class="annot"><span class="annottext">Col i (Row j Z)
</span><a href="#local-6989586621679083719"><span class="hs-identifier hs-var">rws</span></a></span><span>
</span><span id="line-196"></span><span>      </span><span id="local-6989586621679083725"><span class="annot"><span class="annottext">tc :: GLT Z
</span><a href="#local-6989586621679083725"><span class="hs-identifier hs-var hs-var">tc</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Form (GLT Z) -&gt; GLT Z
ProductForm Z (Transformation Z) -&gt; GLT Z
forall x. Constructable x =&gt; Form x -&gt; x
</span><span class="hs-identifier hs-var">make</span></span><span> </span><span class="annot"><span class="annottext">(ProductForm Z (Transformation Z) -&gt; GLT Z)
-&gt; ProductForm Z (Transformation Z) -&gt; GLT Z
forall (h :: * -&gt; * -&gt; *) a b. Applicative h =&gt; h a b -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">N
-&gt; Z
-&gt; [(Z, N)]
-&gt; ProductForm Z (Transformation Z)
-&gt; ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679083732"><span class="hs-identifier hs-var">elims</span></a></span><span> </span><span class="annot"><span class="annottext">N
</span><a href="#local-6989586621679083718"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Z
</span><a href="#local-6989586621679083731"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">[(Z, i)]
[(Z, N)]
</span><a href="#local-6989586621679083720"><span class="hs-identifier hs-var">rw</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point (Transformation Z) -&gt; ProductForm Z (Transformation Z)
forall r a. Point a -&gt; ProductForm r a
</span><span class="hs-identifier hs-var">One</span></span><span> </span><span class="annot"><span class="annottext">Point (Transformation Z)
Dim Z ()
</span><a href="#local-6989586621679083717"><span class="hs-identifier hs-var">dc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">GLT</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Z</span></span><span>
</span><span id="line-197"></span><span>      </span><span>
</span><span id="line-198"></span><span>      </span><span id="local-6989586621679083732"><span class="annot"><span class="annottext">elims :: N
-&gt; Z
-&gt; [(Z, N)]
-&gt; ProductForm Z (Transformation Z)
-&gt; ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679083732"><span class="hs-identifier hs-var hs-var">elims</span></a></span></span><span> </span><span class="annot"><span class="annottext">N
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Z
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621679083733"><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679083733"><span class="hs-identifier hs-var">tc</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679083733"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-199"></span><span>      </span><span class="annot"><a href="#local-6989586621679083732"><span class="hs-identifier hs-var">elims</span></a></span><span> </span><span id="local-6989586621679083734"><span class="annot"><span class="annottext">N
</span><a href="#local-6989586621679083734"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621679083735"><span class="annot"><span class="annottext">Z
</span><a href="#local-6989586621679083735"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621679083736"><span class="annot"><span class="annottext">Z
</span><a href="#local-6989586621679083736"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679083737"><span class="annot"><span class="annottext">N
</span><a href="#local-6989586621679083737"><span class="hs-identifier hs-var">j</span></a></span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679083738"><span class="annot"><span class="annottext">[(Z, N)]
</span><a href="#local-6989586621679083738"><span class="hs-identifier hs-var">bjs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679083739"><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679083739"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">N
-&gt; Z
-&gt; [(Z, N)]
-&gt; ProductForm Z (Transformation Z)
-&gt; ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679083732"><span class="hs-identifier hs-var">elims</span></a></span><span> </span><span class="annot"><span class="annottext">N
</span><a href="#local-6989586621679083734"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Z
</span><a href="#local-6989586621679083740"><span class="hs-identifier hs-var">a'</span></a></span><span> </span><span class="annot"><span class="annottext">[(Z, N)]
</span><a href="#local-6989586621679083738"><span class="hs-identifier hs-var">bjs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679083739"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
-&gt; ProductForm Z (Transformation Z)
-&gt; ProductForm Z (Transformation Z)
forall r a. ProductForm r a -&gt; ProductForm r a -&gt; ProductForm r a
</span><span class="hs-operator hs-var">:*</span></span><span> </span><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679083741"><span class="hs-identifier hs-var">tc'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-200"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679083740"><span class="annot"><span class="annottext">Z
</span><a href="#local-6989586621679083740"><span class="hs-identifier hs-var">a'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679083741"><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679083741"><span class="hs-identifier hs-var">tc'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Dim Z ()
-&gt; (Z, N) -&gt; (Z, N) -&gt; (Z, ProductForm Z (Transformation Z))
forall i.
(i ~ N) =&gt;
Dim Z ()
-&gt; (Z, i) -&gt; (Z, i) -&gt; (Z, ProductForm Z (Transformation Z))
</span><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#tCols"><span class="hs-identifier hs-var">tCols</span></a></span><span> </span><span class="annot"><span class="annottext">Dim Z ()
</span><a href="#local-6989586621679083717"><span class="hs-identifier hs-var">dc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Z
</span><a href="#local-6989586621679083735"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">N
</span><a href="#local-6989586621679083734"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Z
</span><a href="#local-6989586621679083736"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">N
</span><a href="#local-6989586621679083737"><span class="hs-identifier hs-var">j</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-201"></span><span>
</span><span id="line-202"></span><span>
</span><span id="line-203"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-204"></span><span class="hs-comment">-- zmxDiagonalForm -</span><span>
</span><span id="line-205"></span><span>
</span><span id="line-206"></span><span class="annot"><span class="hs-comment">-- | transforming a matrix over Z to a diagonal matrix by applying elements of @'GLT' 'Z'@.</span></span><span>
</span><span id="line-207"></span><span class="annot"><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#zmxDiagonalForm"><span class="hs-identifier hs-type">zmxDiagonalForm</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Matrix</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Z</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DiagonalForm</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Z</span></span><span>
</span><span id="line-208"></span><span id="zmxDiagonalForm"><span class="annot"><span class="annottext">zmxDiagonalForm :: Matrix Z -&gt; DiagonalForm Z
</span><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#zmxDiagonalForm"><span class="hs-identifier hs-var hs-var">zmxDiagonalForm</span></a></span></span><span> </span><span id="local-6989586621679083742"><span class="annot"><span class="annottext">Matrix Z
</span><a href="#local-6989586621679083742"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DiagonalForm Z
</span><a href="#local-6989586621679083743"><span class="hs-identifier hs-var">m'</span></a></span><span>
</span><span id="line-209"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DiagonalFormStrictPositive</span></span><span> </span><span id="local-6989586621679083743"><span class="annot"><span class="annottext">DiagonalForm Z
</span><a href="#local-6989586621679083743"><span class="hs-identifier hs-var">m'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Matrix Z -&gt; DiagonalFormStrictPositive Z
</span><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#zmxDiagonalFormStrictPositive"><span class="hs-identifier hs-var">zmxDiagonalFormStrictPositive</span></a></span><span> </span><span class="annot"><span class="annottext">Matrix Z
</span><a href="#local-6989586621679083742"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-210"></span><span>
</span><span id="line-211"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-212"></span><span class="hs-comment">-- zmxDiagonalFormStrictPositive -</span><span>
</span><span id="line-213"></span><span>
</span><span id="line-214"></span><span class="hs-comment">-- | transforming a matrix over Z to a diagonal matrix with strict positive entries</span><span>
</span><span id="line-215"></span><span class="hs-comment">-- by applying elements of @'GLT' 'Z'@.</span><span>
</span><span id="line-216"></span><span class="hs-comment">--</span><span>
</span><span id="line-217"></span><span class="hs-comment">-- __Property__ Let @m@ be in @'Matrix' Z@ and</span><span>
</span><span id="line-218"></span><span class="hs-comment">-- @'DiagonalFormStrictPositive' d = 'zmxDiagonalFormStrictPositive' m@, then holds:</span><span>
</span><span id="line-219"></span><span class="hs-comment">-- @(a 'OAlg.Structure.Operational.*&gt;' m) 'OAlg.Structure.Operational.&lt;*' b '=='</span><span>
</span><span id="line-220"></span><span class="hs-comment">-- 'diagonal' ('rows' m) ('cols' m) ds@ where  @'DiagonalForm' ds a b = d@.</span><span>
</span><span id="line-221"></span><span class="hs-comment">--</span><span>
</span><span id="line-222"></span><span class="hs-comment">-- __Note__ The entries of the diagonal may not be successively divisible, as such</span><span>
</span><span id="line-223"></span><span class="hs-comment">-- it is a pre-form of the Smith Normal Form.</span><span>
</span><span id="line-224"></span><span class="annot"><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#zmxDiagonalFormStrictPositive"><span class="hs-identifier hs-type">zmxDiagonalFormStrictPositive</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Matrix</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Z</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DiagonalFormStrictPositive</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Z</span></span><span>
</span><span id="line-225"></span><span id="zmxDiagonalFormStrictPositive"><span class="annot"><span class="annottext">zmxDiagonalFormStrictPositive :: Matrix Z -&gt; DiagonalFormStrictPositive Z
</span><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#zmxDiagonalFormStrictPositive"><span class="hs-identifier hs-var hs-var">zmxDiagonalFormStrictPositive</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Matrix</span></span><span> </span><span id="local-6989586621679083749"><span class="annot"><span class="annottext">Dim' Z
</span><a href="#local-6989586621679083749"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621679083750"><span class="annot"><span class="annottext">Dim' Z
</span><a href="#local-6989586621679083750"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679083751"><span class="annot"><span class="annottext">Entries N N Z
</span><a href="#local-6989586621679083751"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-226"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DiagonalForm Z -&gt; DiagonalFormStrictPositive Z
forall k. DiagonalForm k -&gt; DiagonalFormStrictPositive k
</span><span class="hs-identifier hs-var">DiagonalFormStrictPositive</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Z] -&gt; RowTrafo Z -&gt; ColTrafo Z -&gt; DiagonalForm Z
forall k. [k] -&gt; RowTrafo k -&gt; ColTrafo k -&gt; DiagonalForm k
</span><span class="hs-identifier hs-var">DiagonalForm</span></span><span> </span><span class="annot"><span class="annottext">[Z]
</span><a href="#local-6989586621679083752"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GLT Z -&gt; RowTrafo Z
forall a. GLT a -&gt; RowTrafo a
</span><span class="hs-identifier hs-var">RowTrafo</span></span><span> </span><span class="annot"><span class="annottext">(GLT Z -&gt; RowTrafo Z) -&gt; GLT Z -&gt; RowTrafo Z
forall (h :: * -&gt; * -&gt; *) a b. Applicative h =&gt; h a b -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Form (GLT Z) -&gt; GLT Z
forall x. Constructable x =&gt; Form x -&gt; x
</span><span class="hs-identifier hs-var">make</span></span><span> </span><span class="annot"><span class="annottext">Form (GLT Z)
ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679083753"><span class="hs-identifier hs-var">trs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GLT Z -&gt; ColTrafo Z
forall x. GLT x -&gt; ColTrafo x
</span><span class="hs-identifier hs-var">ColTrafo</span></span><span> </span><span class="annot"><span class="annottext">(GLT Z -&gt; ColTrafo Z) -&gt; GLT Z -&gt; ColTrafo Z
forall (h :: * -&gt; * -&gt; *) a b. Applicative h =&gt; h a b -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Form (GLT Z) -&gt; GLT Z
forall x. Constructable x =&gt; Form x -&gt; x
</span><span class="hs-identifier hs-var">make</span></span><span> </span><span class="annot"><span class="annottext">Form (GLT Z)
ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679083754"><span class="hs-identifier hs-var">tcs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-227"></span><span>    </span><span class="hs-keyword">where</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679083752"><span class="annot"><span class="annottext">[Z]
</span><a href="#local-6989586621679083752"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679083753"><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679083753"><span class="hs-identifier hs-var">trs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679083754"><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679083754"><span class="hs-identifier hs-var">tcs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Dim Z () -&gt; Dim Z () -&gt; Col N (Row N Z) -&gt; NF Z
forall i j.
(i ~ N, j ~ N) =&gt;
Dim Z () -&gt; Dim Z () -&gt; Col i (Row j Z) -&gt; NF Z
</span><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#crDiagonalForm"><span class="hs-identifier hs-var">crDiagonalForm</span></a></span><span> </span><span class="annot"><span class="annottext">Dim Z ()
Dim' Z
</span><a href="#local-6989586621679083749"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Dim Z ()
Dim' Z
</span><a href="#local-6989586621679083750"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">(Col N (Row N Z) -&gt; NF Z) -&gt; Col N (Row N Z) -&gt; NF Z
forall (h :: * -&gt; * -&gt; *) a b. Applicative h =&gt; h a b -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Entries N N Z -&gt; Col N (Row N Z)
forall i j x. Eq i =&gt; Entries i j x -&gt; Col i (Row j x)
</span><span class="hs-identifier hs-var">etscr</span></span><span> </span><span class="annot"><span class="annottext">Entries N N Z
</span><a href="#local-6989586621679083751"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-228"></span><span>
</span><span id="line-229"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-230"></span><span class="hs-comment">-- SmithNormalForm -</span><span>
</span><span id="line-231"></span><span>
</span><span id="line-232"></span><span class="hs-comment">-- | the smith normal form.</span><span>
</span><span id="line-233"></span><span class="hs-comment">--</span><span>
</span><span id="line-234"></span><span class="hs-comment">-- __Properties__ Let @s = 'SmithNormalForm' o ds a b@ be in @'SmithNormalForm' 'Z'@,</span><span>
</span><span id="line-235"></span><span class="hs-comment">-- then holds: </span><span>
</span><span id="line-236"></span><span class="hs-comment">--</span><span>
</span><span id="line-237"></span><span class="hs-comment">-- (1) @'snfDiagonalForm' s@ is 'valid'.</span><span>
</span><span id="line-238"></span><span class="hs-comment">--</span><span>
</span><span id="line-239"></span><span class="hs-comment">-- (2) For all @k@ in @ks@ holds: @0 &lt; k@.</span><span>
</span><span id="line-240"></span><span class="hs-comment">--</span><span>
</span><span id="line-241"></span><span class="hs-comment">-- (3) For all @..k':'k'..@ in @ks@ holds: @'mod' k' k '==' 0@.</span><span>
</span><span id="line-242"></span><span class="hs-keyword">data</span><span> </span><span id="SmithNormalForm"><span class="annot"><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#SmithNormalForm"><span class="hs-identifier hs-var">SmithNormalForm</span></a></span></span><span> </span><span id="local-6989586621679083299"><span class="annot"><a href="#local-6989586621679083299"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="SmithNormalForm"><span class="annot"><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#SmithNormalForm"><span class="hs-identifier hs-var">SmithNormalForm</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">N</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679083299"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">RowTrafo</span></span><span> </span><span class="annot"><a href="#local-6989586621679083299"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ColTrafo</span></span><span> </span><span class="annot"><a href="#local-6989586621679083299"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-243"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679083761"><span id="local-6989586621679083774"><span id="local-6989586621679083778"><span class="annot"><span class="annottext">Int -&gt; SmithNormalForm k -&gt; ShowS
[SmithNormalForm k] -&gt; ShowS
SmithNormalForm k -&gt; String
(Int -&gt; SmithNormalForm k -&gt; ShowS)
-&gt; (SmithNormalForm k -&gt; String)
-&gt; ([SmithNormalForm k] -&gt; ShowS)
-&gt; Show (SmithNormalForm k)
forall k. Oriented k =&gt; Int -&gt; SmithNormalForm k -&gt; ShowS
forall k. Oriented k =&gt; [SmithNormalForm k] -&gt; ShowS
forall k. Oriented k =&gt; SmithNormalForm k -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: forall k. Oriented k =&gt; Int -&gt; SmithNormalForm k -&gt; ShowS
showsPrec :: Int -&gt; SmithNormalForm k -&gt; ShowS
$cshow :: forall k. Oriented k =&gt; SmithNormalForm k -&gt; String
show :: SmithNormalForm k -&gt; String
$cshowList :: forall k. Oriented k =&gt; [SmithNormalForm k] -&gt; ShowS
showList :: [SmithNormalForm k] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span id="local-6989586621679083786"><span id="local-6989586621679083796"><span class="annot"><span class="annottext">SmithNormalForm k -&gt; SmithNormalForm k -&gt; Bool
(SmithNormalForm k -&gt; SmithNormalForm k -&gt; Bool)
-&gt; (SmithNormalForm k -&gt; SmithNormalForm k -&gt; Bool)
-&gt; Eq (SmithNormalForm k)
forall k.
Oriented k =&gt;
SmithNormalForm k -&gt; SmithNormalForm k -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: forall k.
Oriented k =&gt;
SmithNormalForm k -&gt; SmithNormalForm k -&gt; Bool
== :: SmithNormalForm k -&gt; SmithNormalForm k -&gt; Bool
$c/= :: forall k.
Oriented k =&gt;
SmithNormalForm k -&gt; SmithNormalForm k -&gt; Bool
/= :: SmithNormalForm k -&gt; SmithNormalForm k -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-244"></span><span>
</span><span id="line-245"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-246"></span><span class="hs-comment">-- snfDiagonalForm -</span><span>
</span><span id="line-247"></span><span>
</span><span id="line-248"></span><span class="annot"><span class="hs-comment">-- | the underlying diagonal form.</span></span><span>
</span><span id="line-249"></span><span id="local-6989586621679083264"><span class="annot"><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#snfDiagonalForm"><span class="hs-identifier hs-type">snfDiagonalForm</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Semiring</span></span><span> </span><span class="annot"><a href="#local-6989586621679083264"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#SmithNormalForm"><span class="hs-identifier hs-type">SmithNormalForm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679083264"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DiagonalForm</span></span><span> </span><span class="annot"><a href="#local-6989586621679083264"><span class="hs-identifier hs-type">k</span></a></span></span><span>
</span><span id="line-250"></span><span id="snfDiagonalForm"><span class="annot"><span class="annottext">snfDiagonalForm :: forall k. Semiring k =&gt; SmithNormalForm k -&gt; DiagonalForm k
</span><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#snfDiagonalForm"><span class="hs-identifier hs-var hs-var">snfDiagonalForm</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#SmithNormalForm"><span class="hs-identifier hs-type">SmithNormalForm</span></a></span><span> </span><span id="local-6989586621679083804"><span class="annot"><span class="annottext">N
</span><a href="#local-6989586621679083804"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span id="local-6989586621679083805"><span class="annot"><span class="annottext">[k]
</span><a href="#local-6989586621679083805"><span class="hs-identifier hs-var">ds</span></a></span></span><span> </span><span id="local-6989586621679083806"><span class="annot"><span class="annottext">RowTrafo k
</span><a href="#local-6989586621679083806"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621679083807"><span class="annot"><span class="annottext">ColTrafo k
</span><a href="#local-6989586621679083807"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-251"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[k] -&gt; RowTrafo k -&gt; ColTrafo k -&gt; DiagonalForm k
forall k. [k] -&gt; RowTrafo k -&gt; ColTrafo k -&gt; DiagonalForm k
</span><span class="hs-identifier hs-var">DiagonalForm</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">N -&gt; [k] -&gt; [k]
forall a. N -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">takeN</span></span><span> </span><span class="annot"><span class="annottext">N
</span><a href="#local-6989586621679083804"><span class="hs-identifier hs-var">o</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">k -&gt; [k]
forall a. a -&gt; [a]
</span><span class="hs-identifier hs-var">repeat</span></span><span> </span><span class="annot"><span class="annottext">k
forall r. Semiring r =&gt; r
</span><span class="hs-identifier hs-var">rOne</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[k] -&gt; [k] -&gt; [k]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[k]
</span><a href="#local-6989586621679083805"><span class="hs-identifier hs-var">ds</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RowTrafo k
</span><a href="#local-6989586621679083806"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">ColTrafo k
</span><a href="#local-6989586621679083807"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-252"></span><span>
</span><span id="line-253"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-254"></span><span class="hs-comment">-- SmithNormalForm - Validable -</span><span>
</span><span id="line-255"></span><span>
</span><span id="line-256"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Validable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#SmithNormalForm"><span class="hs-identifier hs-type">SmithNormalForm</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Z</span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-257"></span><span>  </span><span id="local-6989586621679083820"><span class="annot"><span class="annottext">valid :: SmithNormalForm Z -&gt; Statement
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">valid</span></span></span><span> </span><span id="local-6989586621679083821"><span class="annot"><span class="annottext">s :: SmithNormalForm Z
</span><a href="#local-6989586621679083821"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#SmithNormalForm"><span class="hs-identifier hs-type">SmithNormalForm</span></a></span><span> </span><span class="annot"><span class="annottext">N
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679083822"><span class="annot"><span class="annottext">[Z]
</span><a href="#local-6989586621679083822"><span class="hs-identifier hs-var">ks</span></a></span></span><span> </span><span class="annot"><span class="annottext">RowTrafo Z
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ColTrafo Z
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Label
</span><span class="hs-identifier hs-var">Label</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;SmithNormalForm&quot;</span></span><span> </span><span class="annot"><span class="annottext">Label -&gt; Statement -&gt; Statement
</span><span class="hs-operator hs-var">:&lt;=&gt;:</span></span><span>
</span><span id="line-258"></span><span>    </span><span class="annot"><span class="annottext">[Statement] -&gt; Statement
</span><span class="hs-identifier hs-var">And</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">DiagonalForm Z -&gt; Statement
forall a. Validable a =&gt; a -&gt; Statement
</span><span class="hs-identifier hs-var">valid</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SmithNormalForm Z -&gt; DiagonalForm Z
forall k. Semiring k =&gt; SmithNormalForm k -&gt; DiagonalForm k
</span><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#snfDiagonalForm"><span class="hs-identifier hs-var">snfDiagonalForm</span></a></span><span> </span><span class="annot"><span class="annottext">SmithNormalForm Z
</span><a href="#local-6989586621679083821"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-259"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">N -&gt; [Z] -&gt; Statement
forall {a} {t}.
(Num a, Integral a, Enum t, Show t) =&gt;
t -&gt; [a] -&gt; Statement
</span><a href="#local-6989586621679083826"><span class="hs-identifier hs-var">vld</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">N
</span><span class="hs-number">0</span></span><span class="hs-glyph">::</span><span class="annot"><span class="hs-identifier hs-type">N</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Z]
</span><a href="#local-6989586621679083822"><span class="hs-identifier hs-var">ks</span></a></span><span>
</span><span id="line-260"></span><span>        </span><span class="hs-special">]</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-261"></span><span>
</span><span id="line-262"></span><span>    </span><span id="local-6989586621679083840"><span class="annot"><span class="annottext">vld0 :: b -&gt; a -&gt; Statement
</span><a href="#local-6989586621679083840"><span class="hs-identifier hs-var hs-var">vld0</span></a></span></span><span> </span><span id="local-6989586621679083841"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679083841"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621679083842"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679083842"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Label
</span><span class="hs-identifier hs-var">Label</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;2&quot;</span></span><span> </span><span class="annot"><span class="annottext">Label -&gt; Statement -&gt; Statement
</span><span class="hs-operator hs-var">:&lt;=&gt;:</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679083842"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">Bool -&gt; Message -&gt; Statement
</span><span class="hs-operator hs-var">:?&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Parameter] -&gt; Message
</span><span class="hs-identifier hs-var">Params</span></span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;(k,i)&quot;</span></span><span class="annot"><span class="annottext">String -&gt; String -&gt; Parameter
</span><span class="hs-operator hs-var">:=</span></span><span class="annot"><span class="annottext">(a, b) -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679083842"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679083841"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-263"></span><span>    </span><span>
</span><span id="line-264"></span><span>    </span><span id="local-6989586621679083826"><span class="annot"><span class="annottext">vld :: t -&gt; [a] -&gt; Statement
</span><a href="#local-6989586621679083826"><span class="hs-identifier hs-var hs-var">vld</span></a></span></span><span> </span><span class="annot"><span class="annottext">t
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Statement
</span><span class="hs-identifier hs-var">SValid</span></span><span>
</span><span id="line-265"></span><span>    </span><span class="annot"><a href="#local-6989586621679083826"><span class="hs-identifier hs-var">vld</span></a></span><span> </span><span id="local-6989586621679083991"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679083991"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-special">[</span><span id="local-6989586621679083992"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679083992"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">t -&gt; a -&gt; Statement
forall {a} {b}.
(Ord a, Num a, Show a, Show b) =&gt;
b -&gt; a -&gt; Statement
</span><a href="#local-6989586621679083840"><span class="hs-identifier hs-var">vld0</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679083991"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679083992"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-266"></span><span>    </span><span class="annot"><a href="#local-6989586621679083826"><span class="hs-identifier hs-var">vld</span></a></span><span> </span><span id="local-6989586621679083993"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679083993"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679083994"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679083994"><span class="hs-identifier hs-var">k</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679083995"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679083995"><span class="hs-identifier hs-var">k'</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679083996"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679083996"><span class="hs-identifier hs-var">ks</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-267"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Statement] -&gt; Statement
</span><span class="hs-identifier hs-var">And</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">t -&gt; a -&gt; Statement
forall {a} {b}.
(Ord a, Num a, Show a, Show b) =&gt;
b -&gt; a -&gt; Statement
</span><a href="#local-6989586621679083840"><span class="hs-identifier hs-var">vld0</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679083993"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679083994"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-268"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; Label
</span><span class="hs-identifier hs-var">Label</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;3&quot;</span></span><span> </span><span class="annot"><span class="annottext">Label -&gt; Statement -&gt; Statement
</span><span class="hs-operator hs-var">:&lt;=&gt;:</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679083995"><span class="hs-identifier hs-var">k'</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mod`</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679083994"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-269"></span><span>                </span><span class="annot"><span class="annottext">Bool -&gt; Message -&gt; Statement
</span><span class="hs-operator hs-var">:?&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Parameter] -&gt; Message
</span><span class="hs-identifier hs-var">Params</span></span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;i&quot;</span></span><span class="annot"><span class="annottext">String -&gt; String -&gt; Parameter
</span><span class="hs-operator hs-var">:=</span></span><span class="annot"><span class="annottext">t -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679083993"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;(k,k')&quot;</span></span><span class="annot"><span class="annottext">String -&gt; String -&gt; Parameter
</span><span class="hs-operator hs-var">:=</span></span><span class="annot"><span class="annottext">(a, a) -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679083994"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679083995"><span class="hs-identifier hs-var">k'</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-270"></span><span>
</span><span id="line-271"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">t -&gt; [a] -&gt; Statement
</span><a href="#local-6989586621679083826"><span class="hs-identifier hs-var">vld</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">t -&gt; t
forall a. Enum a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">succ</span></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679083993"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679083995"><span class="hs-identifier hs-var">k'</span></a></span><span class="annot"><span class="annottext">a -&gt; [a] -&gt; [a]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679083996"><span class="hs-identifier hs-var">ks</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-272"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-273"></span><span>
</span><span id="line-274"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Entity</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#SmithNormalForm"><span class="hs-identifier hs-type">SmithNormalForm</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Z</span></span><span class="hs-special">)</span><span>
</span><span id="line-275"></span><span>
</span><span id="line-276"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-277"></span><span class="hs-comment">-- smithNormalForm -</span><span>
</span><span id="line-278"></span><span>
</span><span id="line-279"></span><span class="hs-comment">-- | Smith Normal Form of a matrix.</span><span>
</span><span id="line-280"></span><span class="hs-comment">--</span><span>
</span><span id="line-281"></span><span class="hs-comment">-- __Property__ Let @m@ be in @'Matrix' 'Z'@ and</span><span>
</span><span id="line-282"></span><span class="hs-comment">-- @'SmithNormalForm o ds a b = 'smithNormalForm' m@, then holds:</span><span>
</span><span id="line-283"></span><span class="hs-comment">-- @(a 'OAlg.Structure.Operational.*&gt;' m) 'OAlg.Structure.Operational.&lt;*' b '=='</span><span>
</span><span id="line-284"></span><span class="hs-comment">-- 'diagonal' ('rows' m) ('cols' m) ds@ where</span><span>
</span><span id="line-285"></span><span class="hs-comment">-- @ds = ('takeN' o '$' 'repeat' 1) '++' ds'@. </span><span>
</span><span id="line-286"></span><span class="annot"><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#smithNormalForm"><span class="hs-identifier hs-type">smithNormalForm</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Matrix</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Z</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#SmithNormalForm"><span class="hs-identifier hs-type">SmithNormalForm</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Z</span></span><span>
</span><span id="line-287"></span><span id="smithNormalForm"><span class="annot"><span class="annottext">smithNormalForm :: Matrix Z -&gt; SmithNormalForm Z
</span><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#smithNormalForm"><span class="hs-identifier hs-var hs-var">smithNormalForm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DiagonalFormStrictPositive Z -&gt; SmithNormalForm Z
</span><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#smithNormalForm%27"><span class="hs-identifier hs-var">smithNormalForm'</span></a></span><span> </span><span class="annot"><span class="annottext">(DiagonalFormStrictPositive Z -&gt; SmithNormalForm Z)
-&gt; (Matrix Z -&gt; DiagonalFormStrictPositive Z)
-&gt; Matrix Z
-&gt; SmithNormalForm Z
forall y z x. (y -&gt; z) -&gt; (x -&gt; y) -&gt; x -&gt; z
forall (c :: * -&gt; * -&gt; *) y z x.
Category c =&gt;
c y z -&gt; c x y -&gt; c x z
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Matrix Z -&gt; DiagonalFormStrictPositive Z
</span><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#zmxDiagonalFormStrictPositive"><span class="hs-identifier hs-var">zmxDiagonalFormStrictPositive</span></a></span><span>
</span><span id="line-288"></span><span>
</span><span id="line-289"></span><span>  </span><span>
</span><span id="line-290"></span><span class="hs-comment">-- | Smith Normal Form of a diagonal matrix over 'Z' with strict positive entries.</span><span>
</span><span id="line-291"></span><span class="hs-comment">--</span><span>
</span><span id="line-292"></span><span class="hs-comment">-- __Property__ Let @d = 'DiagonalFormStrictPositive' d' ('DiagonalForm' ds a b)@ be in</span><span>
</span><span id="line-293"></span><span class="hs-comment">-- @'DiagonalFormStrictPositive' 'Z'@, @m = 'dgfMatrix' d'@ and</span><span>
</span><span id="line-294"></span><span class="hs-comment">-- @s = 'smithNormalForm'' d@, then holds: @m '==' 'dgfMatrix' ('snfDiagonalForm' s)@.</span><span>
</span><span id="line-295"></span><span class="annot"><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#smithNormalForm%27"><span class="hs-identifier hs-type">smithNormalForm'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DiagonalFormStrictPositive</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Z</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#SmithNormalForm"><span class="hs-identifier hs-type">SmithNormalForm</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Z</span></span><span>
</span><span id="line-296"></span><span id="smithNormalForm%27"><span class="annot"><span class="annottext">smithNormalForm' :: DiagonalFormStrictPositive Z -&gt; SmithNormalForm Z
</span><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#smithNormalForm%27"><span class="hs-identifier hs-var hs-var">smithNormalForm'</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DiagonalFormStrictPositive</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DiagonalForm</span></span><span> </span><span id="local-6989586621679084011"><span class="annot"><span class="annottext">[Z]
</span><a href="#local-6989586621679084011"><span class="hs-identifier hs-var">ds</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">RowTrafo</span></span><span> </span><span id="local-6989586621679084012"><span class="annot"><span class="annottext">GLT Z
</span><a href="#local-6989586621679084012"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ColTrafo</span></span><span> </span><span id="local-6989586621679084013"><span class="annot"><span class="annottext">GLT Z
</span><a href="#local-6989586621679084013"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-297"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">N -&gt; [Z] -&gt; RowTrafo Z -&gt; ColTrafo Z -&gt; SmithNormalForm Z
forall k. N -&gt; [k] -&gt; RowTrafo k -&gt; ColTrafo k -&gt; SmithNormalForm k
</span><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#SmithNormalForm"><span class="hs-identifier hs-var">SmithNormalForm</span></a></span><span> </span><span class="annot"><span class="annottext">N
</span><a href="#local-6989586621679084014"><span class="hs-identifier hs-var">o</span></a></span><span> </span><span class="annot"><span class="annottext">[Z]
</span><a href="#local-6989586621679084015"><span class="hs-identifier hs-var">ds''</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GLT Z -&gt; RowTrafo Z
forall a. GLT a -&gt; RowTrafo a
</span><span class="hs-identifier hs-var">RowTrafo</span></span><span> </span><span class="annot"><span class="annottext">(GLT Z -&gt; RowTrafo Z) -&gt; GLT Z -&gt; RowTrafo Z
forall (h :: * -&gt; * -&gt; *) a b. Applicative h =&gt; h a b -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Form (GLT Z) -&gt; GLT Z
forall x. Constructable x =&gt; Form x -&gt; x
</span><span class="hs-identifier hs-var">make</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679084016"><span class="hs-identifier hs-var">a'</span></a></span><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
-&gt; ProductForm Z (Transformation Z)
-&gt; ProductForm Z (Transformation Z)
forall r a. ProductForm r a -&gt; ProductForm r a -&gt; ProductForm r a
</span><span class="hs-operator hs-var">:*</span></span><span class="annot"><span class="annottext">GLT Z -&gt; Form (GLT Z)
forall x. Exposable x =&gt; x -&gt; Form x
</span><span class="hs-identifier hs-var">form</span></span><span> </span><span class="annot"><span class="annottext">GLT Z
</span><a href="#local-6989586621679084012"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GLT Z -&gt; ColTrafo Z
forall x. GLT x -&gt; ColTrafo x
</span><span class="hs-identifier hs-var">ColTrafo</span></span><span> </span><span class="annot"><span class="annottext">(GLT Z -&gt; ColTrafo Z) -&gt; GLT Z -&gt; ColTrafo Z
forall (h :: * -&gt; * -&gt; *) a b. Applicative h =&gt; h a b -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Form (GLT Z) -&gt; GLT Z
forall x. Constructable x =&gt; Form x -&gt; x
</span><span class="hs-identifier hs-var">make</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GLT Z -&gt; Form (GLT Z)
forall x. Exposable x =&gt; x -&gt; Form x
</span><span class="hs-identifier hs-var">form</span></span><span> </span><span class="annot"><span class="annottext">GLT Z
</span><a href="#local-6989586621679084013"><span class="hs-identifier hs-var">b</span></a></span><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
-&gt; ProductForm Z (Transformation Z)
-&gt; ProductForm Z (Transformation Z)
forall r a. ProductForm r a -&gt; ProductForm r a -&gt; ProductForm r a
</span><span class="hs-operator hs-var">:*</span></span><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679084017"><span class="hs-identifier hs-var">b'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-298"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-299"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679084018"><span class="annot"><span class="annottext">[Z]
</span><a href="#local-6989586621679084018"><span class="hs-identifier hs-var">ds'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679084016"><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679084016"><span class="hs-identifier hs-var">a'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679084017"><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679084017"><span class="hs-identifier hs-var">b'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(NF Z -&gt; Rdc (NF Z)) -&gt; NF Z -&gt; NF Z
forall x. (x -&gt; Rdc x) -&gt; x -&gt; x
</span><span class="hs-identifier hs-var">reduceWith</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dim' Z -&gt; Dim' Z -&gt; NF Z -&gt; Rdc (NF Z)
</span><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#dnf4"><span class="hs-identifier hs-var">dnf4</span></a></span><span> </span><span class="annot"><span class="annottext">Point (GLT Z)
Dim' Z
</span><a href="#local-6989586621679084021"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Point (GLT Z)
Dim' Z
</span><a href="#local-6989586621679084022"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Z]
</span><a href="#local-6989586621679084011"><span class="hs-identifier hs-var">ds</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Point (Transformation Z) -&gt; ProductForm Z (Transformation Z)
forall r a. Point a -&gt; ProductForm r a
</span><span class="hs-identifier hs-var">One</span></span><span> </span><span class="annot"><span class="annottext">Point (GLT Z)
Point (Transformation Z)
</span><a href="#local-6989586621679084021"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Point (Transformation Z) -&gt; ProductForm Z (Transformation Z)
forall r a. Point a -&gt; ProductForm r a
</span><span class="hs-identifier hs-var">One</span></span><span> </span><span class="annot"><span class="annottext">Point (GLT Z)
Point (Transformation Z)
</span><a href="#local-6989586621679084022"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-300"></span><span>  </span><span id="local-6989586621679084021"><span class="annot"><span class="annottext">n :: Point (GLT Z)
</span><a href="#local-6989586621679084021"><span class="hs-identifier hs-var hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GLT Z -&gt; Point (GLT Z)
forall q. Oriented q =&gt; q -&gt; Point q
</span><span class="hs-identifier hs-var">start</span></span><span> </span><span class="annot"><span class="annottext">GLT Z
</span><a href="#local-6989586621679084012"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-301"></span><span>  </span><span id="local-6989586621679084022"><span class="annot"><span class="annottext">m :: Point (GLT Z)
</span><a href="#local-6989586621679084022"><span class="hs-identifier hs-var hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GLT Z -&gt; Point (GLT Z)
forall q. Oriented q =&gt; q -&gt; Point q
</span><span class="hs-identifier hs-var">end</span></span><span> </span><span class="annot"><span class="annottext">GLT Z
</span><a href="#local-6989586621679084013"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-302"></span><span>  </span><span id="local-6989586621679084015"><span class="annot"><span class="annottext">ds'' :: [Z]
</span><a href="#local-6989586621679084015"><span class="hs-identifier hs-var hs-var">ds''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Z -&gt; Bool) -&gt; [Z] -&gt; [Z]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">dropWhile</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Z -&gt; Z -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span class="annot"><span class="annottext">Z
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Z]
</span><a href="#local-6989586621679084018"><span class="hs-identifier hs-var">ds'</span></a></span><span>
</span><span id="line-303"></span><span>  </span><span id="local-6989586621679084014"><span class="annot"><span class="annottext">o :: N
</span><a href="#local-6989586621679084014"><span class="hs-identifier hs-var hs-var">o</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Z] -&gt; N
forall x. LengthN x =&gt; x -&gt; N
</span><span class="hs-identifier hs-var">lengthN</span></span><span> </span><span class="annot"><span class="annottext">[Z]
</span><a href="#local-6989586621679084018"><span class="hs-identifier hs-var">ds'</span></a></span><span> </span><span class="annot"><span class="annottext">N -&gt; N -&gt; N
</span><span class="hs-operator hs-var">&gt;-</span></span><span> </span><span class="annot"><span class="annottext">[Z] -&gt; N
forall x. LengthN x =&gt; x -&gt; N
</span><span class="hs-identifier hs-var">lengthN</span></span><span> </span><span class="annot"><span class="annottext">[Z]
</span><a href="#local-6989586621679084015"><span class="hs-identifier hs-var">ds''</span></a></span><span>
</span><span id="line-304"></span><span>
</span><span id="line-305"></span><span class="hs-comment">-- | reduces the diagonal entries @...d':'d'... = ds@ to smith normal form entries,</span><span>
</span><span id="line-306"></span><span class="hs-comment">--   i.e. @d' `mod` d '==' 0@.</span><span>
</span><span id="line-307"></span><span class="annot"><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#dnf4"><span class="hs-identifier hs-type">dnf4</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Dim'</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Z</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Dim'</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Z</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#NF"><span class="hs-identifier hs-type">NF</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Z</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Rdc</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#NF"><span class="hs-identifier hs-type">NF</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Z</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-308"></span><span id="dnf4"><span class="annot"><span class="annottext">dnf4 :: Dim' Z -&gt; Dim' Z -&gt; NF Z -&gt; Rdc (NF Z)
</span><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#dnf4"><span class="hs-identifier hs-var hs-var">dnf4</span></a></span></span><span> </span><span id="local-6989586621679084027"><span class="annot"><span class="annottext">Dim' Z
</span><a href="#local-6989586621679084027"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679084028"><span class="annot"><span class="annottext">Dim' Z
</span><a href="#local-6989586621679084028"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NF Z -&gt; Rdc (NF Z)
</span><a href="#local-6989586621679084029"><span class="hs-identifier hs-var">rdcSort</span></a></span><span> </span><span class="annot"><span class="annottext">(NF Z -&gt; Rdc (NF Z)) -&gt; (NF Z -&gt; Rdc (NF Z)) -&gt; NF Z -&gt; Rdc (NF Z)
forall x. (x -&gt; Rdc x) -&gt; (x -&gt; Rdc x) -&gt; x -&gt; Rdc x
</span><span class="hs-operator hs-var">&gt;&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">N -&gt; NF Z -&gt; Rdc (NF Z)
</span><a href="#local-6989586621679084031"><span class="hs-identifier hs-var">rdcDiv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">N
</span><span class="hs-number">0</span></span><span class="hs-glyph">::</span><span class="annot"><span class="hs-identifier hs-type">N</span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-309"></span><span>  </span><span>
</span><span id="line-310"></span><span>  </span><span id="local-6989586621679084029"><span class="annot"><span class="annottext">rdcSort :: NF Z -&gt; Rdc (NF Z)
</span><a href="#local-6989586621679084029"><span class="hs-identifier hs-var hs-var">rdcSort</span></a></span></span><span> </span><span id="local-6989586621679084032"><span class="annot"><span class="annottext">d :: NF Z
</span><a href="#local-6989586621679084032"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621679084033"><span class="annot"><span class="annottext">[Z]
</span><a href="#local-6989586621679084033"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679084034"><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679084034"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679084035"><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679084035"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Permutation N
</span><a href="#local-6989586621679084036"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Permutation N -&gt; Permutation N -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Point (Permutation N) -&gt; Permutation N
forall c. Multiplicative c =&gt; Point c -&gt; c
</span><span class="hs-identifier hs-var">one</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-311"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">NF Z -&gt; Rdc (NF Z)
forall a. a -&gt; Action RdcState a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">NF Z
</span><a href="#local-6989586621679084032"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-312"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">NF Z -&gt; Rdc (NF Z)
forall a. a -&gt; Action RdcState a
</span><span class="hs-identifier hs-var">reducesTo</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Z]
</span><a href="#local-6989586621679084039"><span class="hs-identifier hs-var">ds'</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Transformation Z -&gt; ProductForm Z (Transformation Z)
forall r a. a -&gt; ProductForm r a
</span><span class="hs-identifier hs-var">P</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dim' Z -&gt; Dim' Z -&gt; Permutation N -&gt; Transformation Z
forall x.
Distributive x =&gt;
Dim x (Point x)
-&gt; Dim x (Point x) -&gt; Permutation N -&gt; Transformation x
</span><span class="hs-identifier hs-var">Permute</span></span><span> </span><span class="annot"><span class="annottext">Dim' Z
</span><a href="#local-6989586621679084027"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Dim' Z
</span><a href="#local-6989586621679084027"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Permutation N
</span><a href="#local-6989586621679084036"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
-&gt; ProductForm Z (Transformation Z)
-&gt; ProductForm Z (Transformation Z)
forall r a. ProductForm r a -&gt; ProductForm r a -&gt; ProductForm r a
</span><span class="hs-operator hs-var">:*</span></span><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679084034"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679084035"><span class="hs-identifier hs-var">b</span></a></span><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
-&gt; ProductForm Z (Transformation Z)
-&gt; ProductForm Z (Transformation Z)
forall r a. ProductForm r a -&gt; ProductForm r a -&gt; ProductForm r a
</span><span class="hs-operator hs-var">:*</span></span><span class="annot"><span class="annottext">Transformation Z -&gt; ProductForm Z (Transformation Z)
forall r a. a -&gt; ProductForm r a
</span><span class="hs-identifier hs-var">P</span></span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dim' Z -&gt; Dim' Z -&gt; Permutation N -&gt; Transformation Z
forall x.
Distributive x =&gt;
Dim x (Point x)
-&gt; Dim x (Point x) -&gt; Permutation N -&gt; Transformation x
</span><span class="hs-identifier hs-var">Permute</span></span><span> </span><span class="annot"><span class="annottext">Dim' Z
</span><a href="#local-6989586621679084028"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Dim' Z
</span><a href="#local-6989586621679084028"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Permutation N -&gt; Permutation N
forall c. Invertible c =&gt; c -&gt; c
</span><span class="hs-identifier hs-var">invert</span></span><span> </span><span class="annot"><span class="annottext">Permutation N
</span><a href="#local-6989586621679084036"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-313"></span><span>    </span><span class="hs-keyword">where</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679084039"><span class="annot"><span class="annottext">[Z]
</span><a href="#local-6989586621679084039"><span class="hs-identifier hs-var">ds'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679084036"><span class="annot"><span class="annottext">Permutation N
</span><a href="#local-6989586621679084036"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Z -&gt; Z -&gt; Ordering) -&gt; (Z -&gt; Z) -&gt; [Z] -&gt; ([Z], Permutation N)
forall (s :: * -&gt; *) x w.
PermutableSequence s N x =&gt;
(w -&gt; w -&gt; Ordering) -&gt; (x -&gt; w) -&gt; s x -&gt; (s x, Permutation N)
</span><span class="hs-identifier hs-var">permuteByN</span></span><span> </span><span class="annot"><span class="annottext">Z -&gt; Z -&gt; Ordering
forall a. Ord a =&gt; a -&gt; a -&gt; Ordering
</span><span class="hs-identifier hs-var">compare</span></span><span> </span><span class="annot"><span class="annottext">Z -&gt; Z
forall x. x -&gt; x
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">[Z]
</span><a href="#local-6989586621679084033"><span class="hs-identifier hs-var">ds</span></a></span><span>
</span><span id="line-314"></span><span>
</span><span id="line-315"></span><span>  </span><span id="local-6989586621679084031"><span class="annot"><span class="annottext">rdcDiv :: N -&gt; NF Z -&gt; Rdc (NF Z)
</span><a href="#local-6989586621679084031"><span class="hs-identifier hs-var hs-var">rdcDiv</span></a></span></span><span> </span><span id="local-6989586621679084044"><span class="annot"><span class="annottext">N
</span><a href="#local-6989586621679084044"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679084045"><span class="annot"><span class="annottext">[Z]
</span><a href="#local-6989586621679084045"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679084046"><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679084046"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679084047"><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679084047"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[Z]
</span><a href="#local-6989586621679084045"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-316"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679084048"><span class="annot"><span class="annottext">Z
</span><a href="#local-6989586621679084048"><span class="hs-identifier hs-var">d</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679084049"><span class="annot"><span class="annottext">Z
</span><a href="#local-6989586621679084049"><span class="hs-identifier hs-var">d'</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679084050"><span class="annot"><span class="annottext">[Z]
</span><a href="#local-6989586621679084050"><span class="hs-identifier hs-var">ds'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Z
</span><a href="#local-6989586621679084049"><span class="hs-identifier hs-var">d'</span></a></span><span> </span><span class="annot"><span class="annottext">Z -&gt; Z -&gt; Z
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mod`</span></span><span> </span><span class="annot"><span class="annottext">Z
</span><a href="#local-6989586621679084048"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Z -&gt; Z -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Z
</span><span class="hs-number">0</span></span><span>
</span><span id="line-317"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NF Z -&gt; Rdc (NF Z)
forall a. a -&gt; Action RdcState a
</span><span class="hs-identifier hs-var">reducesTo</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Z
</span><a href="#local-6989586621679084052"><span class="hs-identifier hs-var">e</span></a></span><span class="annot"><span class="annottext">Z -&gt; [Z] -&gt; [Z]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">Z
</span><a href="#local-6989586621679084053"><span class="hs-identifier hs-var">e'</span></a></span><span class="annot"><span class="annottext">Z -&gt; [Z] -&gt; [Z]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[Z]
</span><a href="#local-6989586621679084050"><span class="hs-identifier hs-var">ds'</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679084054"><span class="hs-identifier hs-var">a'</span></a></span><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
-&gt; ProductForm Z (Transformation Z)
-&gt; ProductForm Z (Transformation Z)
forall r a. ProductForm r a -&gt; ProductForm r a -&gt; ProductForm r a
</span><span class="hs-operator hs-var">:*</span></span><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679084046"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679084047"><span class="hs-identifier hs-var">b</span></a></span><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
-&gt; ProductForm Z (Transformation Z)
-&gt; ProductForm Z (Transformation Z)
forall r a. ProductForm r a -&gt; ProductForm r a -&gt; ProductForm r a
</span><span class="hs-operator hs-var">:*</span></span><span class="annot"><span class="annottext">Transformation Z -&gt; ProductForm Z (Transformation Z)
forall r a. a -&gt; ProductForm r a
</span><span class="hs-identifier hs-var">P</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dim' Z -&gt; N -&gt; N -&gt; GL2 Z -&gt; Transformation Z
forall x.
Galoisian x =&gt;
Dim x (Point x) -&gt; N -&gt; N -&gt; GL2 x -&gt; Transformation x
</span><span class="hs-identifier hs-var">Shear</span></span><span> </span><span class="annot"><span class="annottext">Dim' Z
</span><a href="#local-6989586621679084028"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">N
</span><a href="#local-6989586621679084044"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">N
</span><a href="#local-6989586621679084055"><span class="hs-identifier hs-var">i'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Z -&gt; Z -&gt; Z -&gt; Z -&gt; GL2 Z
forall x. x -&gt; x -&gt; x -&gt; x -&gt; GL2 x
</span><span class="hs-identifier hs-var">GL2</span></span><span> </span><span class="annot"><span class="annottext">Z
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Z
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Z
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Z
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
-&gt; ProductForm Z (Transformation Z)
-&gt; ProductForm Z (Transformation Z)
forall r a. ProductForm r a -&gt; ProductForm r a -&gt; ProductForm r a
</span><span class="hs-operator hs-var">:*</span></span><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679084056"><span class="hs-identifier hs-var">b'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-318"></span><span>          </span><span id="local-6989586621679084055"><span class="annot"><span class="annottext">i' :: N
</span><a href="#local-6989586621679084055"><span class="hs-identifier hs-var hs-var">i'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">N -&gt; N
forall a. Enum a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">succ</span></span><span> </span><span class="annot"><span class="annottext">N
</span><a href="#local-6989586621679084044"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-319"></span><span>          </span><span class="hs-special">(</span><span class="hs-special">[</span><span id="local-6989586621679084052"><span class="annot"><span class="annottext">Z
</span><a href="#local-6989586621679084052"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679084053"><span class="annot"><span class="annottext">Z
</span><a href="#local-6989586621679084053"><span class="hs-identifier hs-var">e'</span></a></span></span><span class="hs-special">]</span><span class="hs-special">,</span><span id="local-6989586621679084054"><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679084054"><span class="hs-identifier hs-var">a'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679084056"><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679084056"><span class="hs-identifier hs-var">b'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">N -&gt; Dim' Z -&gt; Dim' Z -&gt; Col N (Row N Z) -&gt; NF Z
forall i j.
(i ~ N, j ~ N) =&gt;
i -&gt; Dim' Z -&gt; Dim' Z -&gt; Col i (Row j Z) -&gt; NF Z
</span><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#dnf%27"><span class="hs-identifier hs-var">dnf'</span></a></span><span> </span><span class="annot"><span class="annottext">N
</span><a href="#local-6989586621679084044"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Dim' Z
</span><a href="#local-6989586621679084027"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Dim' Z
</span><a href="#local-6989586621679084028"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Entries N N Z -&gt; Col N (Row N Z)
forall i j x. Eq i =&gt; Entries i j x -&gt; Col i (Row j x)
</span><span class="hs-identifier hs-var">etscr</span></span><span> </span><span class="annot"><span class="annottext">Entries N N Z
</span><a href="#local-6989586621679084057"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-320"></span><span>          </span><span class="hs-comment">-- from ds is stirct positive follows that dnf yields a diagonal with two elements </span><span>
</span><span id="line-321"></span><span>          </span><span id="local-6989586621679084057"><span class="annot"><span class="annottext">xs :: Entries N N Z
</span><a href="#local-6989586621679084057"><span class="hs-identifier hs-var hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PSequence (N, N) Z -&gt; Entries N N Z
forall i j x. PSequence (i, j) x -&gt; Entries i j x
</span><span class="hs-identifier hs-var">Entries</span></span><span> </span><span class="annot"><span class="annottext">(PSequence (N, N) Z -&gt; Entries N N Z)
-&gt; PSequence (N, N) Z -&gt; Entries N N Z
forall (h :: * -&gt; * -&gt; *) a b. Applicative h =&gt; h a b -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[(Z, (N, N))] -&gt; PSequence (N, N) Z
forall i x. [(x, i)] -&gt; PSequence i x
</span><span class="hs-identifier hs-var">PSequence</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Z
</span><a href="#local-6989586621679084048"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">N
</span><a href="#local-6989586621679084044"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">N
</span><a href="#local-6989586621679084044"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Z
</span><a href="#local-6989586621679084049"><span class="hs-identifier hs-var">d'</span></a></span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">N
</span><a href="#local-6989586621679084055"><span class="hs-identifier hs-var">i'</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">N
</span><a href="#local-6989586621679084044"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Z
</span><a href="#local-6989586621679084049"><span class="hs-identifier hs-var">d'</span></a></span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">N
</span><a href="#local-6989586621679084055"><span class="hs-identifier hs-var">i'</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">N
</span><a href="#local-6989586621679084055"><span class="hs-identifier hs-var">i'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span>
</span><span id="line-322"></span><span>                   </span><span>
</span><span id="line-323"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679084060"><span class="annot"><span class="annottext">Z
</span><a href="#local-6989586621679084060"><span class="hs-identifier hs-var">d</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679084061"><span class="annot"><span class="annottext">[Z]
</span><a href="#local-6989586621679084061"><span class="hs-identifier hs-var">ds'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">N -&gt; NF Z -&gt; Rdc (NF Z)
</span><a href="#local-6989586621679084031"><span class="hs-identifier hs-var">rdcDiv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">N -&gt; N
forall a. Enum a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">succ</span></span><span> </span><span class="annot"><span class="annottext">N
</span><a href="#local-6989586621679084044"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Z]
</span><a href="#local-6989586621679084061"><span class="hs-identifier hs-var">ds'</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679084046"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679084047"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Rdc (NF Z) -&gt; (NF Z -&gt; Rdc (NF Z)) -&gt; Rdc (NF Z)
forall a b.
Action RdcState a -&gt; (a -&gt; Action RdcState b) -&gt; Action RdcState b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679084062"><span class="annot"><span class="annottext">[Z]
</span><a href="#local-6989586621679084062"><span class="hs-identifier hs-var">ds'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679084063"><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679084063"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679084064"><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679084064"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NF Z -&gt; Rdc (NF Z)
forall a. a -&gt; Action RdcState a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Z
</span><a href="#local-6989586621679084060"><span class="hs-identifier hs-var">d</span></a></span><span class="annot"><span class="annottext">Z -&gt; [Z] -&gt; [Z]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[Z]
</span><a href="#local-6989586621679084062"><span class="hs-identifier hs-var">ds'</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679084063"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679084064"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-324"></span><span>    </span><span>
</span><span id="line-325"></span><span>    </span><span class="annot"><span class="annottext">[Z]
</span><span class="hs-identifier">_</span></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NF Z -&gt; Rdc (NF Z)
forall a. a -&gt; Action RdcState a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Z]
</span><a href="#local-6989586621679084045"><span class="hs-identifier hs-var">ds</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679084046"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">ProductForm Z (Transformation Z)
</span><a href="#local-6989586621679084047"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-326"></span><span>
</span><span id="line-327"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-328"></span><span class="hs-comment">-- prpDiagonalFormZ -</span><span>
</span><span id="line-329"></span><span>
</span><span id="line-330"></span><span class="annot"><span class="hs-comment">-- | validating diagonal and Smith Normal form for 'Z'-matrices.</span></span><span>
</span><span id="line-331"></span><span class="annot"><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#prpDiagonalFormZ"><span class="hs-identifier hs-type">prpDiagonalFormZ</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">N</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Statement</span></span><span>
</span><span id="line-332"></span><span id="prpDiagonalFormZ"><span class="annot"><span class="annottext">prpDiagonalFormZ :: N -&gt; Q -&gt; Statement
</span><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#prpDiagonalFormZ"><span class="hs-identifier hs-var hs-var">prpDiagonalFormZ</span></a></span></span><span> </span><span id="local-6989586621679084065"><span class="annot"><span class="annottext">N
</span><a href="#local-6989586621679084065"><span class="hs-identifier hs-var">dMax</span></a></span></span><span> </span><span id="local-6989586621679084066"><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679084066"><span class="hs-identifier hs-var">dens</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Label
</span><span class="hs-identifier hs-var">Prp</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;DiagonalFormZ&quot;</span></span><span> </span><span class="annot"><span class="annottext">Label -&gt; Statement -&gt; Statement
</span><span class="hs-operator hs-var">:&lt;=&gt;:</span></span><span>
</span><span id="line-333"></span><span>  </span><span class="annot"><span class="annottext">X (Matrix Z) -&gt; (Matrix Z -&gt; Statement) -&gt; Statement
forall x. X x -&gt; (x -&gt; Statement) -&gt; Statement
</span><span class="hs-identifier hs-var">Forall</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XOrtOrientation (Matrix Z) -&gt; X (Matrix Z)
forall q. XOrtOrientation q -&gt; XOrt q
</span><span class="hs-identifier hs-var">xoOrt</span></span><span> </span><span class="annot"><span class="annottext">(XOrtOrientation (Matrix Z) -&gt; X (Matrix Z))
-&gt; XOrtOrientation (Matrix Z) -&gt; X (Matrix Z)
forall (h :: * -&gt; * -&gt; *) a b. Applicative h =&gt; h a b -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">N -&gt; Q -&gt; X Z -&gt; XOrtOrientation (Matrix Z)
forall x.
(Distributive x, Total x) =&gt;
N -&gt; Q -&gt; X x -&gt; XOrtOrientation (Matrix x)
</span><span class="hs-identifier hs-var">xMatrixTtl</span></span><span> </span><span class="annot"><span class="annottext">N
</span><a href="#local-6989586621679084065"><span class="hs-identifier hs-var">dMax</span></a></span><span> </span><span class="annot"><span class="annottext">Q
</span><a href="#local-6989586621679084066"><span class="hs-identifier hs-var">dens</span></a></span><span> </span><span class="annot"><span class="annottext">X Z
forall x. XStandard x =&gt; X x
</span><span class="hs-identifier hs-var">xStandard</span></span><span class="hs-special">)</span><span>
</span><span id="line-334"></span><span>    </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679084072"><span class="annot"><span class="annottext">Matrix Z
</span><a href="#local-6989586621679084072"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679084073"><span class="annot"><span class="annottext">d :: DiagonalFormStrictPositive Z
</span><a href="#local-6989586621679084073"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DiagonalFormStrictPositive</span></span><span> </span><span id="local-6989586621679084074"><span class="annot"><span class="annottext">DiagonalForm Z
</span><a href="#local-6989586621679084074"><span class="hs-identifier hs-var">d'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Matrix Z -&gt; DiagonalFormStrictPositive Z
</span><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#zmxDiagonalFormStrictPositive"><span class="hs-identifier hs-var">zmxDiagonalFormStrictPositive</span></a></span><span> </span><span class="annot"><span class="annottext">Matrix Z
</span><a href="#local-6989586621679084072"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-335"></span><span>               </span><span id="local-6989586621679084075"><span class="annot"><span class="annottext">s :: SmithNormalForm Z
</span><a href="#local-6989586621679084075"><span class="hs-identifier hs-var hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DiagonalFormStrictPositive Z -&gt; SmithNormalForm Z
</span><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#smithNormalForm%27"><span class="hs-identifier hs-var">smithNormalForm'</span></a></span><span> </span><span class="annot"><span class="annottext">DiagonalFormStrictPositive Z
</span><a href="#local-6989586621679084073"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-336"></span><span>           </span><span class="hs-keyword">in</span><span>
</span><span id="line-337"></span><span>             </span><span class="annot"><span class="annottext">[Statement] -&gt; Statement
</span><span class="hs-identifier hs-var">And</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(DiagonalFormStrictPositive Z, SmithNormalForm Z) -&gt; Statement
forall a. Validable a =&gt; a -&gt; Statement
</span><span class="hs-identifier hs-var">valid</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DiagonalFormStrictPositive Z
</span><a href="#local-6989586621679084073"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">SmithNormalForm Z
</span><a href="#local-6989586621679084075"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-338"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; Label
</span><span class="hs-identifier hs-var">Label</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;DiagonalForm&quot;</span></span><span> </span><span class="annot"><span class="annottext">Label -&gt; Statement -&gt; Statement
</span><span class="hs-operator hs-var">:&lt;=&gt;:</span></span><span>
</span><span id="line-339"></span><span>                     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Matrix Z
</span><a href="#local-6989586621679084072"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Matrix Z -&gt; Matrix Z -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">DiagonalForm Z -&gt; Matrix Z
forall k. Distributive k =&gt; DiagonalForm k -&gt; Matrix k
</span><span class="hs-identifier hs-var">dgfMatrix</span></span><span> </span><span class="annot"><span class="annottext">DiagonalForm Z
</span><a href="#local-6989586621679084074"><span class="hs-identifier hs-var">d'</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">Bool -&gt; Message -&gt; Statement
</span><span class="hs-operator hs-var">:?&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Parameter] -&gt; Message
</span><span class="hs-identifier hs-var">Params</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;m&quot;</span></span><span class="annot"><span class="annottext">String -&gt; String -&gt; Parameter
</span><span class="hs-operator hs-var">:=</span></span><span class="annot"><span class="annottext">Matrix Z -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Matrix Z
</span><a href="#local-6989586621679084072"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-340"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; Label
</span><span class="hs-identifier hs-var">Label</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;SmithNormalForm&quot;</span></span><span> </span><span class="annot"><span class="annottext">Label -&gt; Statement -&gt; Statement
</span><span class="hs-operator hs-var">:&lt;=&gt;:</span></span><span>
</span><span id="line-341"></span><span>                     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Matrix Z
</span><a href="#local-6989586621679084072"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Matrix Z -&gt; Matrix Z -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">DiagonalForm Z -&gt; Matrix Z
forall k. Distributive k =&gt; DiagonalForm k -&gt; Matrix k
</span><span class="hs-identifier hs-var">dgfMatrix</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SmithNormalForm Z -&gt; DiagonalForm Z
forall k. Semiring k =&gt; SmithNormalForm k -&gt; DiagonalForm k
</span><a href="OAlg.AbelianGroup.Free.SmithNormalForm.html#snfDiagonalForm"><span class="hs-identifier hs-var">snfDiagonalForm</span></a></span><span> </span><span class="annot"><span class="annottext">SmithNormalForm Z
</span><a href="#local-6989586621679084075"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="annot"><span class="annottext">Bool -&gt; Message -&gt; Statement
</span><span class="hs-operator hs-var">:?&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Parameter] -&gt; Message
</span><span class="hs-identifier hs-var">Params</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;m&quot;</span></span><span class="annot"><span class="annottext">String -&gt; String -&gt; Parameter
</span><span class="hs-operator hs-var">:=</span></span><span class="annot"><span class="annottext">Matrix Z -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Matrix Z
</span><a href="#local-6989586621679084072"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-342"></span><span>                 </span><span class="hs-special">]</span><span>
</span><span id="line-343"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-344"></span><span>
</span><span id="line-345"></span><span>
</span><span id="line-346"></span></pre></body></html>